var t=Object.prototype.hasOwnProperty,e=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,a=Object.assign,n=(a,n)=>{var o={};for(var r in a)t.call(a,r)&&n.indexOf(r)<0&&(o[r]=a[r]);if(null!=a&&e)for(var r of e(a))n.indexOf(r)<0&&i.call(a,r)&&(o[r]=a[r]);return o},o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACCCAMAAAD2dTMiAAAABlBMVEX////a2vL9uN09AAAA3UlEQVR4nO3VIQ4AQRACwd3/f/rUatSlSWjUOCqYOeflll8FBIECu68CgsB/rlue/gXxYoEC6WKB80D6U6T0L4gXCxRIFwucB9KfIqV/QbxYoEC6WOA8kP4UKf0L4sUCBdLFAueB9KdI6V8QLxYokC4WOA+kP0VK/4J4sUCBdLHAeSD9KVL6F8SLBQqkiwXOA+lPkdK/IF4sUCBdLHAeSH+KlP4F8WKBAuligfNA+lOk9C+IFwsUSBcLnAfSnyKlf0G8WKBAuljgPJD+FCn9C+LFAgXSxQLngfSnSPkAtCAPcZpa2JAAAAAASUVORK5CYII=",r="data:image/png;base64,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",l="data:image/png;base64,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",s="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgc3R5bGU9IndpZHRoOiAxZW07aGVpZ2h0OiAxZW07dmVydGljYWwtYWxpZ246IG1pZGRsZTtmaWxsOiBjdXJyZW50Q29sb3I7b3ZlcmZsb3c6IGhpZGRlbjsiIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwLWlkPSIzOTA0OSI+PHBhdGggZD0iTTc3OS43MzMzMzMgNjRjMi40NzQ2NjcgMCA0Ljg2NCAwLjc2OCA2LjgyNjY2NyAyLjE3NmwxOTIuMDQyNjY3IDEzNy4xNzMzMzNhMTEuNzMzMzMzIDExLjczMzMzMyAwIDAgMSAwIDE5LjExNDY2N2wtMTkyIDEzNy4xNzMzMzNBMTEuNzMzMzMzIDExLjczMzMzMyAwIDAgMSA3NjggMzUwLjA4TDc2Ny45NTczMzMgMjU2aC0yMzcuOTk0NjY2Yy02LjgyNjY2NyAwLTE0LjI1MDY2NyA3LjQ2NjY2Ny0xNS43ODY2NjcgMTguOTAxMzMzbC0wLjI5ODY2NyA0LjQ4djQ2NS4yMzczMzRjMCAxMi4zNzMzMzMgNi42MTMzMzMgMjEuMjQ4IDEzLjQ4MjY2NyAyMy4wNGwyLjU2IDAuMzQxMzMzSDc2OEw3NjggNjc0LjM0NjY2N2ExMS43MzMzMzMgMTEuNzMzMzMzIDAgMCAxIDE4LjU2LTkuNTU3MzM0bDE5Mi4wNDI2NjcgMTM3LjE3MzMzNGExMS43MzMzMzMgMTEuNzMzMzMzIDAgMCAxIDAgMTkuMTE0NjY2bC0xOTIgMTM3LjE3MzMzNGExMS43MzMzMzMgMTEuNzMzMzMzIDAgMCAxLTE4LjYwMjY2Ny05LjU1NzMzNEw3NjcuOTU3MzMzIDg1My4zMzMzMzNoLTIzNy45OTQ2NjZjLTU0LjkxMiAwLTk3Ljg3NzMzMy00NS44MjQtMTAxLjIwNTMzNC0xMDEuNzE3MzMzbC0wLjIxMzMzMy02Ljk5NzMzM0w0MjguNTAxMzMzIDU1NC42NjY2NjdIMjkxLjM3MDY2N2ExMjguMDQyNjY3IDEyOC4wNDI2NjcgMCAxIDEgMC04NS4zMzMzMzRoMTM3LjEzMDY2NlYyNzkuMzgxMzMzYzAtNTYuNjE4NjY3IDQwLjc4OTMzMy0xMDQuNzA0IDk0LjY3NzMzNC0xMDguNDU4NjY2TDUyOS45MiAxNzAuNjY2NjY3aDIzNy45OTQ2NjdMNzY4IDc1LjczMzMzM2MwLTYuNDg1MzMzIDUuMjQ4LTExLjczMzMzMyAxMS43MzMzMzMtMTEuNzMzMzMzeiIgcC1pZD0iMzkwNTAiPjwvcGF0aD48L3N2Zz4=";const d=navigator.userAgent,h=(d.indexOf("Firefox"),d.indexOf("Chrome")>-1),c=(d.indexOf("MSIE"),d.indexOf("Windows NT 6.1; Trident/7.0;"),function(t,e,i,a){let n=document.createElementNS(t,e);return i.appendChild(n),p(n,a),n}),p=function(t,e){let i=arguments.length;if(3==i){let e=arguments[1],i=arguments[2];e&&(i?t.setAttribute(e,i):t.removeAttribute(e))}else{if(!e)return;for(let i in e){let a=e[i];a?t.setAttribute(i,a):t.removeAttribute(i)}}},u=function(t){if("string"==typeof t)return t;if(!Array.isArray(t))return null;let e=[];for(let i of t){let[t,a,n]=i;e.push(t),e.push(a),n&&(e.push(","),e.push(n))}return console.log(e),e.join("")},g=(t,e,i)=>{let a=`on${e}`;t.addEventListener?t.addEventListener(e,i):t.attachEvent?t.attachEvent(a,i):t[a]=i},m=(t,e)=>{if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,e);else{const i=window.URL.createObjectURL(new Blob([t])),a=document.createElement("a");a.style.display="none",a.download=e,a.href=i,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}},y=t=>{t.preventDefault(),t.stopPropagation()};function f(t,e){let i=e.length;if(0==i)return t;let a=e[0],n=e[1];if(!a)return null;if("string"==typeof a)return 2==i?t[a]=n:t[a];if("object"==typeof a&&1==i){for(let e in a)t[e]=a[e];return a}return null}const x=["x","y","width","height","cursor","text-anchor","font-family","font-size","font-style","left","top","width","height","opacity","color","borderColor","max-width","max-height"];function v(t,e,i){this.isSvg()||!x.includes(e)?i?t.setAttribute(e,i.toString()):t.removeAttribute(e):w(t,e,i)}function w(t,e,i){switch(e){case"x":t.style.left=`${i}px`;break;case"y":t.style.top=`${i}px`;break;case"width":t.style.width=`${i}px`;break;case"height":t.style.height=`${i}px`;break;default:t.style[e]=i?i.toString():null}}let A=-1,b=0;class E{constructor(t){this.node=t,this.datas={},this.attrs={};let e=function(){let t=Date.now(),e=t-t%1e3;if(A==e){if(999==b){for(;A==e;)t=Date.now(),e=t-t%1e3;b=0}return(e+ ++b).toString(36)}return b=0,A=e,e.toString(36)}();this.id=e}get id(){return this._id}set id(t){this._id=t,p(this.node,{"data-element-id":t})}isSvg(){return!1}drag(t,e,i){let a=this,n={};const o=e=>{if("function"==typeof t){const{pageX:i,pageY:o}=e;let{pageX:r,pageY:l}=n;t.call(a,i-r,o-l,e)}},r=t=>{"function"==typeof i&&i.call(a,t),delete n.pageX,delete n.pageY,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",r)};let l=function(t){(t=>{const{pageX:i,pageY:o}=t;Object.assign(n,{pageX:i,pageY:o}),"function"==typeof e&&e.call(a,t)})(t),document.addEventListener("mousemove",o),document.addEventListener("mouseup",r),t.stopPropagation(),t.preventDefault()};return this.mousedownFn=l,g(this.node,"mousedown",l),this}undrag(){((t,e,i)=>{let a=`on${e}`;t.removeEventListener?t.removeEventListener(e,i):t.deachEvent?t.deachEvent(a,i):t[a]=null})(this.node,"mousedown",this.mousedownFn)}click(t){let e=this;return g(this.node,"click",(i=>{t.call(e,i)})),this}dblclick(t){let e=this;return g(this.node,"dblclick",(i=>{t.call(e,i)})),this}mouseover(t){let e=this;return g(this.node,"mouseover",(i=>{t.call(e,i)})),this}mouseout(t){let e=this;return g(this.node,"mouseout",(i=>{t.call(e,i)})),this}hover(t,e){return"function"==typeof t&&this.mouseover(t),"function"==typeof e&&this.mouseout(e),this}hide(){return w(this.node,"display","none"),this.hidden=!0,this}show(){return w(this.node,"display",null),this.hidden=!1,this}isHidden(){return this.hidden}attr(){let t=arguments.length,e=arguments[0],i=arguments[1],a=typeof e,n=!1;if(1==t){if("object"==a&&e){n=!0;for(let t in e){let i=e[t];v.call(this,this.node,t,i)}}}else t>1&&"string"==a&&(v.call(this,this.node,e,i),n=!0);let o=f(this.attrs||(this.attrs={}),arguments);return n?this:o}data(){let t=arguments[0],e=arguments.length>1||t&&"object"==typeof t,i=f(this.datas||(this.datas={}),arguments);return e?this:i}removeData(t){delete this.datas[t]}remove(){this.data("text")&&this.data("text").remove(),this.node.remove(),this.attrs=null,this.datas=null,this.removed=!0}}class M extends E{constructor(t){super(t),this.type="html"}updateHTML(t){this.node.innerHTML=t}}class k extends M{constructor(t,e){super(t),this.nowrap=e}setText(t){return this.node.innerHTML=`<div title="${t}" style="transform: translate(-50%, -50%);overflow: hidden;word-break: break-all;box-sizing: border-box;font-family: Arial, sans-serif; font-size: 12px; font-weight: normal;">${t}</div>`,Object.assign(this.attrs,{text:t}),this.setNowrap(this.nowrap),this}setNowrap(t){let e=this.node.childNodes[0];e&&(t?Object.assign(e.style,{maxWidth:"100%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}):Object.assign(e.style,{maxWidth:null,textOverflow:null,overflow:null,whiteSpace:null}))}attr(){let[t,e]=arguments,i=arguments.length;if("text"==t&&"string"==typeof e)return this.setText(e);if(1==i&&"object"==typeof t){let{text:e,width:i,height:o}=t,r=n(t,["text","width","height"]);return e&&this.setText(e),super.attr(a({},r))}return super.attr(...arguments)}}class C extends E{constructor(t){super(t)}isSvg(){return!0}}class T extends C{constructor(t){super(t),this.type="rect"}}class S extends C{constructor(t){super(t),this.type="path",p(t,{fill:"none"})}attr(){let[t,e]=arguments,i=arguments.length;if("path"==t&&"string"==typeof e)return super.attr("d",e);if("object"==typeof t&&t&&1==i){let{path:e}=t,i=n(t,["path"]),o=u(e);return super.attr(a({d:o},i))}return super.attr(...arguments)}getPointAtLength(t){return this.node.getPointAtLength(t)}getBBox(){return this.node.getBBox()}}class z extends C{constructor(t){super(t),this.type="image"}setHref(t){this.node.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t)}}class N extends C{constructor(t){super(t),this.type="circle"}}class L extends C{constructor(t){super(t),this.type="text"}setText(t){return this.node.innerHTML=`<tspan dy="4">${t}</tspan>`,Object.assign(this.attrs,{text:t}),this}attr(){let[t,e]=arguments,i=arguments.length;if("text"==t&&"string"==typeof e)return this.setText(e);if(1==i&&t&&"object"==typeof t){let{text:e}=t,i=n(t,["text"]);return e&&this.setText(e),super.attr(a({},i))}return super.attr(...arguments)}}let D=0;var I={properties:{historyActions:[],currentActionIndex:-1},methods:{addAction(t){let{undo:e,redo:i}=t||{};"function"==typeof e&&"function"==typeof i?(t.uid=++D,this.historyActions.splice(++this.currentActionIndex,this.historyActions.length-this.currentActionIndex,t),this.historyActions.length>20&&(this.historyActions.shift(),--this.currentActionIndex)):console.error("Error: undo redo should be defined as function")},clearHistory(){this.historyActions=[],this.currentActionIndex=-1},undo:function(){let t;console.log("undo"),(t=this.historyActions[this.currentActionIndex])&&(t.undo(),--this.currentActionIndex)},redo:function(){let t;console.log("redo"),(t=this.historyActions[this.currentActionIndex+1])&&(++this.currentActionIndex,t.redo())}}};const O="http://www.w3.org/2000/svg";class P{constructor(t,e,i){let a;a="string"==typeof t?document.querySelector(dom):t,this.$parent=a;let n=c(O,"svg",a,{width:e||"100%",height:i||"100%",version:"1.1",xmlns:O,"xmlns:xlink":"http://www.w3.org/1999/xlink",style:"overflow: visible; position: relative; user-select: none; cursor: default;"});c(O,"defs",n),this.svg=n,this.canvas=n}rect(t,e,i,a,n){let o={x:t,y:e,width:i,height:a,rx:n,ry:n},r=c(O,"rect",this.svg),l=new T(r);return l.attr(o),l}path(t){let e=c(O,"path",this.svg),i=new S(e);return i.attr("d",u(t)),i}image(t,e,i,a,n,o){let r={x:e,y:i,width:a,height:n,rx:o,ry:o},l=c(O,"image",this.svg,r),s=new z(l);return s.setHref(t),s}text(t,e){let i=c(O,"text",this.svg,{x:t,y:e});return new L(i)}circle(t,e,i){let a=c(O,"circle",this.svg),n=new N(a);return n.attr({x:t,y:e,r:i}),n}clear(){this.canvas.querySelectorAll("*[data-element-id]").forEach((t=>{t.remove()}))}remove(){this.clear(),this.svg.remove(),this.svg=this.canvas=null,this.removed=!0}}const j={select:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n               <path d="M736.21333333 638.08l69.76-54.08c5.22666667-4.05333333 8-10.45333333 7.46666667-17.06666667-0.53333333-6.61333333-4.37333333-12.48-10.24-15.57333333L450.02666666 361.38666666c-6.82666667-3.62666667-15.04-2.98666667-21.12 1.70666667-6.08 4.69333333-8.85333333 12.58666667-7.04 20.05333333l95.57333334 389.54666667c1.6 6.4 6.29333333 11.62666667 12.48 13.76 6.18666667 2.13333333 13.12 1.06666667 18.34666666-2.98666667l69.86666667-54.08L769.06666666 924.37333333c3.2 4.05333333 7.78666667 6.72 12.90666667 7.36 0.85333333 0.10666667 1.6 0.10666667 2.45333333 0.10666667 4.26666667 0 8.53333333-1.38666667 11.94666667-4.05333334l87.25333333-67.52c8.53333333-6.61333333 10.02666667-18.88 3.52-27.30666666L736.21333333 638.08zM178.24 282.02666666l-31.25333334-21.01333333c-14.61333333 21.76-27.30666667 44.90666667-37.86666666 68.90666667l34.56 15.14666666c9.6-21.86666667 21.22666667-43.09333333 34.56-63.04zM549.54666666 103.89333333l3.2-37.54666667c-26.02666667-2.24-52.69333333-2.13333333-78.50666666 0.21333334l3.41333333 37.54666666c23.57333333-2.13333333 48-2.24 71.89333333-0.21333333zM120.74666666 413.22666666l-36.69333333-8.74666666c-6.08 25.38666667-9.92 51.52-11.30666667 77.76l37.65333334 2.13333333c1.38666667-24 4.8-47.89333333 10.34666666-71.14666667zM112.64 556.26666666l-37.44 4.48c3.09333333 26.02666667 8.64 51.94666667 16.32 76.90666667l36.05333333-11.09333333c-7.04-22.82666667-12.05333333-46.50666667-14.93333333-70.29333334zM919.36 327.46666666c-10.66666667-23.89333333-23.46666667-46.93333333-38.29333334-68.58666666l-31.14666666 21.22666666c13.44 19.84 25.28 40.96 34.98666666 62.82666667l34.45333334-15.46666667zM831.36 197.97333333c-18.34666667-18.77333333-38.4-35.94666667-59.62666667-51.09333333L749.86666666 177.6c19.52 13.86666667 37.86666667 29.65333333 54.61333334 46.82666666l26.88-26.45333333zM703.89333333 107.09333333c-23.68-11.2-48.53333333-20.37333333-73.81333333-27.09333333l-9.81333334 36.37333333c23.14666667 6.18666667 45.86666667 14.61333333 67.52 24.85333333l16.10666667-34.13333333zM277.76 178.98666666l-22.08-30.50666666c-21.22666667 15.36-41.17333333 32.64-59.41333334 51.52l27.09333334 26.13333333c16.74666667-17.28 35.09333333-33.06666667 54.4-47.14666667zM348.90666666 918.08c24.32 9.81333333 49.6 17.49333333 75.2 22.82666666l7.68-36.90666666c-23.46666667-4.90666667-46.61333333-11.94666667-68.8-20.90666667l-14.08 34.98666667zM503.25333333 912.42666666l-1.06666667 37.65333334c4.16 0.10666667 8.42666667 0.21333333 12.58666667 0.21333333 21.97333333 0 44.16-1.6 65.81333333-4.90666667l-5.54666666-37.22666666c-23.57333333 3.52-47.89333333 4.90666667-71.78666667 4.26666666zM944.85333333 401.81333333l-36.58666667 8.96c5.65333333 23.14666667 9.28 47.14666667 10.77333334 71.04l37.65333333-2.34666667c-1.70666667-26.13333333-5.65333333-52.26666667-11.84-77.65333333zM396.8 80.64c-25.28 6.93333333-50.02666667 16.21333333-73.6 27.62666666l16.32 33.92c21.54666667-10.34666667 44.26666667-18.88 67.30666666-25.17333333L396.8 80.64zM121.17333333 710.4c11.94666667 23.25333333 26.13333333 45.54666667 42.13333333 66.34666666l29.86666667-22.93333333c-14.61333333-18.98666667-27.52-39.46666667-38.50666667-60.69333333L121.17333333 710.4zM216.42666666 834.66666666c19.30666667 17.70666667 40.42666667 33.70666667 62.50666667 47.68l20.05333333-31.89333333c-20.26666667-12.8-39.46666667-27.41333333-57.17333333-43.62666667l-25.38666667 27.84z"></path>\n            </svg>',start:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n               <path d="M400.43759 732.273456a71.33239 71.33239 0 0 0 34.157473 8.810938 75.556813 75.556813 0 0 0 41.157944-12.069778l219.790665-144.837341a85.574729 85.574729 0 0 0 38.502593-72.418671 83.402169 83.402169 0 0 0-37.295615-70.608203l-221.842527-144.837341a72.41867 72.41867 0 0 0-74.591231-3.741631 84.488449 84.488449 0 0 0-41.761433 75.436115v289.674681a84.488449 84.488449 0 0 0 41.882131 74.591231z m42.002829-82.315889V374.163131l207.600188 135.664309v0.965582a13.156058 13.156058 0 0 1 0 2.293258z"></path>\n               <path d="M149.989688 874.093352a509.948138 509.948138 0 1 0-109.714286-162.700613 513.206978 513.206978 0 0 0 109.714286 162.700613zM84.571489 512a428.11504 428.11504 0 1 1 427.511551 428.11504A428.597831 428.597831 0 0 1 84.571489 512z" ></path>\n            </svg>',end:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M512 0c282.752 0 512 229.248 512 512s-229.248 512-512 512S0 794.752 0 512 229.248 0 512 0z m0 85.333333C276.352 85.333333 85.333333 276.352 85.333333 512s191.018667 426.666667 426.666667 426.666667 426.666667-191.018667 426.666667-426.666667S747.648 85.333333 512 85.333333z m85.333333 256a85.333333 85.333333 0 0 1 85.333334 85.333334v170.666666a85.333333 85.333333 0 0 1-85.333334 85.333334h-170.666666a85.333333 85.333333 0 0 1-85.333334-85.333334v-170.666666a85.333333 85.333333 0 0 1 85.333334-85.333334h170.666666z"></path>\n          </svg>',xor:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M485.871492 47.174338c-9.168729-0.008066-18.33651 3.392487-25.137616 10.224908L57.381424 460.755494c-13.603161 13.602212-13.540056 36.674443 0.062631 50.276655l403.288872 403.286025c13.603161 13.606956 36.673969 13.66674 50.276655 0l403.352926-403.350079c13.602686-13.601737 13.539581-36.674918-0.064054-50.27713L511.009107 57.399246c-6.801106-6.801106-15.969361-10.217316-25.137615-10.224908z m-0.030841 59.805036l378.943153 378.946-378.943153 378.94173-378.943153-378.94173 378.943153-378.946zM344.31891 317.829311c-0.006643 0-4.560641 0.872083-4.564436 0.872083-0.004745 0-3.864114 2.615773-3.866961 2.615773l-14.581525 14.584847c-0.004745 0-2.661797 3.902546-2.663696 3.94857 0 0.004745-0.824161 4.498011-0.823686 4.498011 0 0.004745 0.886317 4.452936 0.88774 4.452935 0 0.004745 2.532741 3.94857 2.535588 3.94857l133.188084 133.184763-133.12403 133.12498v-0.041754c0 0.004745-2.661797 3.947621-2.663696 3.947621 0 0.004745-0.823686 4.499434-0.823686 4.499434 0 0.009489 0.886317 4.452936 0.88774 4.452936 0 0 2.533215 3.901597 2.535588 3.947621l14.582474 14.579627c0.004745 0.004745 3.990798 2.617197 3.994119 2.617197 0.004745 0 4.434431 0.872083 4.438227 0.872083 0.004745 0 4.497536-0.825584 4.500858-0.825584 0.004745 0 3.928642-2.663695 3.931014-2.663696l133.125929-133.128775 133.154871 133.156769c0.004745 0.004745 3.991273 2.617197 3.99412 2.617197 0.004745 0 4.434431 0.872083 4.438226 0.872083 0.004745 0 4.498011-0.827008 4.501807-0.827008 0.004745 0 3.926744-2.661797 3.929116-2.661797l14.582949-14.580577c0.004745-0.004745 2.597743-3.855573 2.600116-3.855573 0-0.004745 0.88774-4.545458 0.88774-4.591007 0-0.004745-0.886791-4.452936-0.888689-4.452936 0 0-2.59632-3.994119-2.599167-3.994119l-133.140163-133.142535 133.141112-133.139214c0.004745 0 2.596794-3.856048 2.599167-3.856048 0-0.004745 0.88774-4.544509 0.88774-4.544509 0-0.009489-0.886317-4.452936-0.887266-4.452935 0-0.004745-2.659899-3.94857-2.662746-3.94857l-14.582949-14.584372c-0.004745 0-3.863639-2.616248-3.86696-2.616248-0.004745 0-4.433957-0.873032-4.437753-0.873032-0.004745 0-4.561116 0.873032-4.564436 0.873032-0.004745 0-3.864588 2.616248-3.866961 2.616248l-133.143484 133.143484-133.203268-133.207538v-0.041754c-0.004745 0-3.927693-2.5242-3.931014-2.5242-0.004745 0-4.431584-0.871608-4.436804-0.872083h-0.000949z"></path>\n                </svg>',or:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M485.871492 47.174338c-9.168729-0.008066-18.33651 3.392487-25.137616 10.224908L57.381424 460.755494c-13.603161 13.602212-13.540056 36.674443 0.062631 50.276655l403.288872 403.286025c13.603161 13.606956 36.673969 13.66674 50.276655 0l403.352926-403.350079c13.602686-13.601737 13.539581-36.674918-0.064054-50.27713L511.009107 57.399246c-6.801106-6.801106-15.969361-10.217316-25.137615-10.224908z m-0.030841 59.805036l378.943153 378.946-378.943153 378.94173-378.943153-378.94173 378.943153-378.946z m-8.957589 186.164969l-0.000949 0.197381c0 0.004745-3.969921 0.735434-3.971345 0.735435-0.004745 0-3.251568 2.203456-3.25394 2.203455-0.004745 0-2.260393 3.350733-2.262291 3.350734 0 0.004745-0.763903 3.994119-0.765326 3.994119V439.440713l-96.147347-96.147348h0.004745c-0.004745 0-3.414787-2.203456-3.416211-2.203456-0.005694 0-3.803856-0.771969-3.832798-0.777188-0.037009 0.005694-3.945249 0.732113-3.947147 0.732113-0.004745-0.004745-3.352157 2.249005-3.35358 2.249006l-12.636658 12.629066-2.306416 3.397231c-0.004745 0-0.713608 3.901597-0.713609 3.901597 0 0.004745 0.765801 3.856048 0.766275 3.856048 0 0.004745 2.188747 3.397232 2.189696 3.397232l96.099901 96.101323H303.419279l-0.026571-0.032264c0 0.004745-3.953315 0.871608-3.955212 0.871608-0.004745 0.004745-3.250619 2.20393-3.252992 2.20393v-0.023249c-0.004745 0.004745-2.259918 3.352157-2.261816 3.352157-0.004745 0-0.764852 3.993171-0.766275 3.99317v17.871526s0.759158 4.040143 0.786677 4.040143c0 0.009489 2.251378 3.259634 2.251852 3.259635 0.004745 0 3.271022 2.203456 3.271971 2.203455 0.004745 0.009489 3.970396 0.872083 3.971819 0.872083h135.870285L343.2912 601.205873v-0.03606c-0.004745 0.004745-2.305942 3.397232-2.306891 3.397231-0.004745 0.004745-0.714557 3.901597-0.714557 3.901597 0 0.009015 0.767224 3.856048 0.767698 3.856048 0 0 2.196813 3.397232 2.189696 3.397232l12.638556 12.629066c0.004745 0.004745 3.453219 2.249005 3.454168 2.249005l3.847033 0.780509c0.005694 0 3.896852-0.734011 3.89875-0.734011 0 0 3.402451-2.295504 3.403874-2.295503l96.160633-96.160633v136.107996l-0.025147-0.026571c0 0.004745 0.787626 4.039194 0.786677 4.039195 0 0.004745 2.251378 3.259634 2.251378 3.259634 0.004745 0.004745 3.271022 2.203456 3.271971 2.203456 0 0 3.942402 0.826059 3.971819 0.872082l17.865832-0.004745c0.004745 0 4.048209-0.825584 4.050582-0.825584 0 0 3.250619-2.20393 3.252991-2.20393 0.004745-0.004745 2.24948-3.25916 2.251853-3.25916 0 0 0.774816-4.040143 0.776713-4.040143v-136.030657l96.091834 96.087564c-0.004745 0.009489 3.452271 2.249005 3.454168 2.249005 0.004745 0.004745 3.846084 0.735434 3.847508 0.735435 0.005694 0 3.896378-0.735434 3.89875-0.735435 0 0 3.401976-2.295504 3.404823-2.295503l12.632862-12.637132c0.004745 0 2.239041-3.352157 2.26751-3.352157 0-0.009489 0.778137-3.947621 0.759157-3.99317 0-0.004745-0.767698-3.856997-0.768647-3.856997-0.005694 0.004745-2.236194-3.442781-2.265612-3.442781l-95.851276-95.857444h135.679072c0.004745 0.004745 4.048209-0.826533 4.049633-0.826533 0.004745 0 3.251568-2.20393 3.252991-2.203931 0.004745-0.009015 2.249005-3.25916 2.251852-3.259159 0 0 0.774816-4.039194 0.776714-4.039195v-17.867255c0-0.004745-0.771494-3.947621-0.770071-3.99412-0.004745-0.004745-2.240465-3.350733-2.267984-3.350733-0.004745-0.004745-3.271496-2.20393-3.27292-2.20393 0 0.004745-4.036822-0.871608-4.03872-0.825584h-136.09044l96.283047-96.280201c0.004745-0.004745 2.238092-3.351682 2.266561-3.351682 0-0.009489 0.77956-3.947621 0.77956-3.947621 0-0.004745-0.766749-3.856522-0.767224-3.856522-0.004745-0.004745-2.299299-3.397232-2.300248-3.397231l-12.635709-12.638082c-0.004745 0-3.341244-2.249005-3.342667-2.249005-0.004745-0.004745-3.846084-0.734485-3.848456-0.734485-0.005694 0-3.960432 0.734011-3.961855 0.734011-0.004745 0.004745-3.352631 2.249005-3.35358 2.249005l-96.162531 96.161582V303.47838c0-0.004745-0.771494-3.948096-0.770071-3.994119-0.004745-0.009489-2.239516-3.351208-2.239516-3.351208-0.004745-0.004745-3.271496-2.203456-3.272445-2.203456-0.004745 0-4.048209-0.780509-4.049158-0.780509l-17.868679-0.004745z m-113.645937 47.167429l0.016132-0.002372h-0.029892l0.014235 0.002847z" p-id="3577"></path>\n                </svg>',and:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M485.871492 47.174338c-9.168729-0.008066-18.33651 3.392487-25.137616 10.224908L57.381424 460.755494c-13.603161 13.602212-13.540056 36.674443 0.062631 50.276655l403.288872 403.286025c13.603161 13.606956 36.673969 13.66674 50.276655 0l403.352926-403.350079c13.602686-13.601737 13.539581-36.674918-0.064054-50.27713L511.009107 57.399246c-6.801106-6.801106-15.969361-10.217316-25.137615-10.224908z m-0.030841 59.805036l378.943153 378.946-378.943153 378.94173-378.943153-378.94173 378.943153-378.946z m-10.34495 156.490911c0 0.004745-4.581992 0.872083-4.584365 0.872082-0.004745 0-3.752138 2.525623-3.754984 2.525624-0.004745 0.004745-2.608182 3.856048-2.610555 3.856047 0 0.004745-0.882521 4.590533-0.883944 4.590533V463.610402H275.283938l-0.03179-0.037009c0 0.004745-4.563488 1.010154-4.56586 1.010155-0.004745 0.004745-3.751663 2.525149-3.754036 2.525149l0.003796-0.046499c-0.004745 0.004745-2.608182 3.856048-2.610554 3.856048-0.004745 0-0.882996 4.591007-0.884893 4.591007v20.625371s0.876827 4.641776 0.908142 4.673566c0 0.004745 2.599167 3.764474 2.599167 3.764474 0.004745 0.004745 3.775387 2.525149 3.776811 2.525149 0.004745 0.004745 4.581518 1.009206 4.583415 1.009206h188.355615v188.264041l-0.029892-0.02752c0 0.004745 0.909092 4.673566 0.908617 4.673566 0 0.004745 2.598218 3.764 2.598218 3.764 0.004745 0.004745 3.776811 2.5242 3.777285 2.5242 0 0 4.550203 0.964131 4.584365 1.010629l20.6211-0.004745c0.005219 0 4.671668-0.964131 4.674515-0.964131 0 0 3.752138-2.5242 3.754985-2.5242 0.004745-0.004745 2.595371-3.765423 2.598218-3.765423 0 0 0.895332-4.659332 0.896755-4.659331V508.125523h188.309116c0.005219 0.004745 4.672142-0.963656 4.67404-0.963656 0.004745 0 3.753087-2.525149 3.754985-2.525149 0.004745-0.004745 2.595846-3.764474 2.598692-3.764474 0 0 0.894857-4.659332 0.896756-4.659332v-20.6211c0-0.004745-0.890587-4.545458-0.889164-4.591008-0.004745-0.004745-2.585882-3.856048-2.618146-3.856047-0.004745-0.004745-3.775862-2.5242-3.77681-2.5242 0 0.004745-4.659332-1.010629-4.661704-0.964605h-188.289188V275.364866c0-0.004745-0.891062-4.544034-0.889638-4.590059-0.004745-0.004745-2.585882-3.856997-2.585882-3.856996-0.004745-0.004745-3.774913-2.5242-3.775862-2.5242-0.004745 0-4.672617-0.918581-4.674514-0.918582l-20.624897-0.004744z"></path>\n                </svg>',join:'<svg style="width: 100%;height: 100%;transform: rotate(45deg); vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M485.871492 47.174338c-9.168729-0.008066-18.33651 3.392487-25.137616 10.224908L57.381424 460.755494c-13.603161 13.602212-13.540056 36.674443 0.062631 50.276655l403.288872 403.286025c13.603161 13.606956 36.673969 13.66674 50.276655 0l403.352926-403.350079c13.602686-13.601737 13.539581-36.674918-0.064054-50.27713L511.009107 57.399246c-6.801106-6.801106-15.969361-10.217316-25.137615-10.224908z m-0.030841 59.805036l378.943153 378.946-378.943153 378.94173-378.943153-378.94173 378.943153-378.946zM344.31891 317.829311c-0.006643 0-4.560641 0.872083-4.564436 0.872083-0.004745 0-3.864114 2.615773-3.866961 2.615773l-14.581525 14.584847c-0.004745 0-2.661797 3.902546-2.663696 3.94857 0 0.004745-0.824161 4.498011-0.823686 4.498011 0 0.004745 0.886317 4.452936 0.88774 4.452935 0 0.004745 2.532741 3.94857 2.535588 3.94857l133.188084 133.184763-133.12403 133.12498v-0.041754c0 0.004745-2.661797 3.947621-2.663696 3.947621 0 0.004745-0.823686 4.499434-0.823686 4.499434 0 0.009489 0.886317 4.452936 0.88774 4.452936 0 0 2.533215 3.901597 2.535588 3.947621l14.582474 14.579627c0.004745 0.004745 3.990798 2.617197 3.994119 2.617197 0.004745 0 4.434431 0.872083 4.438227 0.872083 0.004745 0 4.497536-0.825584 4.500858-0.825584 0.004745 0 3.928642-2.663695 3.931014-2.663696l133.125929-133.128775 133.154871 133.156769c0.004745 0.004745 3.991273 2.617197 3.99412 2.617197 0.004745 0 4.434431 0.872083 4.438226 0.872083 0.004745 0 4.498011-0.827008 4.501807-0.827008 0.004745 0 3.926744-2.661797 3.929116-2.661797l14.582949-14.580577c0.004745-0.004745 2.597743-3.855573 2.600116-3.855573 0-0.004745 0.88774-4.545458 0.88774-4.591007 0-0.004745-0.886791-4.452936-0.888689-4.452936 0 0-2.59632-3.994119-2.599167-3.994119l-133.140163-133.142535 133.141112-133.139214c0.004745 0 2.596794-3.856048 2.599167-3.856048 0-0.004745 0.88774-4.544509 0.88774-4.544509 0-0.009489-0.886317-4.452936-0.887266-4.452935 0-0.004745-2.659899-3.94857-2.662746-3.94857l-14.582949-14.584372c-0.004745 0-3.863639-2.616248-3.86696-2.616248-0.004745 0-4.433957-0.873032-4.437753-0.873032-0.004745 0-4.561116 0.873032-4.564436 0.873032-0.004745 0-3.864588 2.616248-3.866961 2.616248l-133.143484 133.143484-133.203268-133.207538v-0.041754c-0.004745 0-3.927693-2.5242-3.931014-2.5242-0.004745 0-4.431584-0.871608-4.436804-0.872083h-0.000949z"></path>\n                </svg>',task:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S793.6 0 512 0zM512 960c-249.6 0-448-198.4-448-448 0-249.6 198.4-448 448-448 249.6 0 448 198.4 448 448C960 761.6 761.6 960 512 960z"></path>\n                <path d="M704 320c0-108.8-83.2-192-192-192C403.2 128 320 211.2 320 320s83.2 192 192 192C620.8 512 704 428.8 704 320zM512 448C441.6 448 384 390.4 384 320c0-70.4 57.6-128 128-128 70.4 0 128 57.6 128 128C640 390.4 582.4 448 512 448z"></path>\n                <path d="M512 512c-179.2 0-320 115.2-320 256 0 19.2 12.8 32 32 32S256 787.2 256 768c0-108.8 115.2-192 256-192 140.8 0 256 83.2 256 192 0 19.2 12.8 32 32 32S832 787.2 832 768C832 627.2 691.2 512 512 512z"></path>\n           </svg>',reset:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M790.2 590.67l105.978 32.29C847.364 783.876 697.86 901 521 901c-216.496 0-392-175.504-392-392s175.504-392 392-392c108.502 0 206.708 44.083 277.685 115.315l-76.64 76.64C670.99 257.13 599.997 225 521.5 225 366.032 225 240 351.032 240 506.5 240 661.968 366.032 788 521.5 788c126.148 0 232.916-82.978 268.7-197.33z"></path>\n                <path d="M855.58 173.003L650.426 363.491l228.569 32.285z"></path>\n           </svg>',imp:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M746.666667 469.333333H554.666667V213.333333l42.666666 42.666667 51.2 51.2L746.666667 213.333333l59.733333 59.733334-98.133333 98.133333 21.333333 21.333333 38.4 34.133334 42.666667 42.666666h-64zM512 213.333333v85.333334H298.666667v426.666666h426.666666v-213.333333h85.333334v298.666667H213.333333V213.333333h298.666667z"></path>\n           </svg>',exp:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M469.333333 162.133333h85.333334v469.333334c0 12.8-8.533333 21.333333-21.333334 21.333333h-42.666666c-12.8 0-21.333333-8.533333-21.333334-21.333333v-469.333334z"></path>\n                <path d="M315.733333 392.533333L285.866667 362.666667c-8.533333-8.533333-8.533333-21.333333 0-29.866667l211.2-211.2c8.533333-8.533333 21.333333-8.533333 29.866666 0l44.8 44.8-226.133333 226.133333c-8.533333 8.533333-21.333333 8.533333-29.866667 0z"></path>\n                <path d="M452.266667 166.4l44.8-44.8c8.533333-8.533333 21.333333-8.533333 29.866666 0l211.2 211.2c8.533333 8.533333 8.533333 21.333333 0 29.866667l-29.866666 29.866666c-8.533333 8.533333-21.333333 8.533333-29.866667 0L452.266667 166.4zM896 503.466667h-42.666667c-12.8 0-21.333333 8.533333-21.333333 21.333333v277.333333c0 12.8-8.533333 21.333333-21.333333 21.333334H213.333333c-12.8 0-21.333333-8.533333-21.333333-21.333334v-277.333333c0-12.8-8.533333-21.333333-21.333333-21.333333H128c-12.8 0-21.333333 8.533333-21.333333 21.333333v362.666667c0 12.8 8.533333 21.333333 21.333333 21.333333h768c12.8 0 21.333333-8.533333 21.333333-21.333333v-362.666667c0-12.8-8.533333-21.333333-21.333333-21.333333z"></path>\n                <path d="M277.333333 588.8H149.333333v-85.333333h128c12.8 0 21.333333 8.533333 21.333334 21.333333v42.666667c0 10.666667-8.533333 21.333333-21.333334 21.333333zM874.666667 588.8h-128c-12.8 0-21.333333-8.533333-21.333334-21.333333v-42.666667c0-12.8 8.533333-21.333333 21.333334-21.333333h128v85.333333z"></path>\n           </svg>',picture:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M986.112 446.7712a38.4 38.4 0 0 0 38.4-38.4V144.128a140.9536 140.9536 0 0 0-140.8-140.8L140.7488 3.6864a140.9536 140.9536 0 0 0-140.8 140.8v735.3856a140.9536 140.9536 0 0 0 140.8 140.8l742.9632-0.4096a140.9536 140.9536 0 0 0 140.8-140.8V588.288c0-3.6864-1.1264-7.0144-2.0992-10.3936a37.8368 37.8368 0 0 0-11.9808-29.5936L785.8176 342.6304c-26.0096-23.8592-65.8432-24.576-96.2048 1.9968l-163.1232 182.8864-146.2272-84.9408a70.8608 70.8608 0 0 0-53.3504-13.6192 70.3488 70.3488 0 0 0-44.544 26.4704L179.6096 563.8656a38.4 38.4 0 0 0 55.7056 52.8384l103.8336-109.568 145.9712 84.8384c25.9584 20.0192 62.976 18.9952 91.5968-5.888l162.3552-182.1184 208.5888 191.0272v284.4672c0 35.2768-28.7232 64-64 64l-742.912 0.4096c-35.2768 0-64-28.7232-64-64V144.4864c0-35.2768 28.7232-64 64-64l742.9632-0.4096c35.2768 0 64 28.7232 64 64v264.2944c0 21.1968 17.2032 38.4 38.4 38.4z"></path>\n                <path d="M264.4992 248.4224m-49.664 0a49.664 49.664 0 1 0 99.328 0 49.664 49.664 0 1 0-99.328 0Z"></path>\n              </svg>',del:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                <path d="M202.666667 256h-42.666667a32 32 0 0 1 0-64h704a32 32 0 0 1 0 64H266.666667v565.333333a53.333333 53.333333 0 0 0 53.333333 53.333334h384a53.333333 53.333333 0 0 0 53.333333-53.333334V352a32 32 0 0 1 64 0v469.333333c0 64.8-52.533333 117.333333-117.333333 117.333334H320c-64.8 0-117.333333-52.533333-117.333333-117.333334V256z m224-106.666667a32 32 0 0 1 0-64h170.666666a32 32 0 0 1 0 64H426.666667z m-32 288a32 32 0 0 1 64 0v256a32 32 0 0 1-64 0V437.333333z m170.666666 0a32 32 0 0 1 64 0v256a32 32 0 0 1-64 0V437.333333z" fill="#000000" p-id="3009"></path>\n          </svg>',overview:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;transform: scale(0.85);" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M512 349.888A162.112 162.112 0 1 0 674.112 512 162.32 162.32 0 0 0 512 349.888z m0 231.6A69.488 69.488 0 1 1 581.488 512 69.552 69.552 0 0 1 512 581.488z"></path>\n                    <path d="M972.8 460.8h-54.4a410.304 410.304 0 0 0-355.2-355.2V51.2a51.2 51.2 0 1 0-102.4 0v54.4a410.304 410.304 0 0 0-355.2 355.2H51.2a51.2 51.2 0 1 0 0 102.4h54.4a410.304 410.304 0 0 0 355.2 355.2v54.4a51.2 51.2 0 0 0 102.4 0v-54.4a410.304 410.304 0 0 0 355.2-355.2h54.4a51.2 51.2 0 0 0 0-102.4zM512 819.2A307.2 307.2 0 1 1 819.2 512 307.456 307.456 0 0 1 512 819.2z"></path>\n                </svg>',zoomReset:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M514.2 854.1c-188 0-340.9-152.9-340.9-340.9s152.9-340.9 340.9-340.9 340.9 152.9 340.9 340.9-152.9 340.9-340.9 340.9z m0-598.8C372 255.3 256.3 371 256.3 513.2S372 771.1 514.2 771.1s257.9-115.7 257.9-257.9-115.7-257.9-257.9-257.9z"></path>\n                    <path d="M888.5 554.7H742.1c-22.9 0-41.5-18.6-41.5-41.5s18.6-41.5 41.5-41.5h146.5c22.9 0 41.5 18.6 41.5 41.5-0.1 22.9-18.6 41.5-41.6 41.5zM288 554.7H141.5c-22.9 0-41.5-18.6-41.5-41.5s18.6-41.5 41.5-41.5H288c22.9 0 41.5 18.6 41.5 41.5s-18.6 41.5-41.5 41.5zM515 327.7c-22.9 0-41.5-18.6-41.5-41.5V139.7c0-22.9 18.6-41.5 41.5-41.5s41.5 18.6 41.5 41.5v146.4c0 23-18.5 41.6-41.5 41.6zM515 928.2c-22.9 0-41.5-18.6-41.5-41.5V740.3c0-22.9 18.6-41.5 41.5-41.5s41.5 18.6 41.5 41.5v146.5c0 22.8-18.5 41.4-41.5 41.4z"></path>\n                </svg>',zoomIn:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"></path>\n                    <path d="M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z"></path>\n                </svg>',zoomOut:'<svg style="width: 100%;height: 100%;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z" ></path>\n                    <path d="M625.792 448H336a32 32 0 0 0 0 64h289.792a32 32 0 1 0 0-64z"></path>\n              </svg>',business:'<div style="width: 100%;height: 100%;overflow: hidden;text-align: center;">\n                    <div class="" contenteditable="true">节点名称</div>\n               </div>'},B=(t,e)=>{if(!e)return;let i=`connect-arrow-${e}`,a=t.querySelector("marker[id='"+i+"']");a||(a=document.createElement("marker"),a.setAttribute("id",i),t.querySelector("defs").appendChild(a),a=t.querySelector("marker[id='"+i+"']"),a.outerHTML=`\n                             <marker id="${i}" fill="${e}" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">\n                                <use xlink:href="#connect-arrow-path" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use>\n                             </marker>\n                        `),i=`connect-condition-${e}`,a=t.querySelector("marker[id='"+i+"']"),a||(a=document.createElement("marker"),a.setAttribute("id",i),t.querySelector("defs").appendChild(a),a=t.querySelector("marker[id='"+i+"']"),a.outerHTML=`\n                            <marker id="${i}" viewBox="0 0 20 20" refX="-15" refY="10" markerWidth="10" markerHeight="10" orient="auto">\n                                <path d="M 0 10 L 8 6 L 16 10 L 8 14 Z" fill="#fff" stroke="${e}"  stroke-width="1"></path>\n                            </marker>\n                        `)},R=a({},j);M.prototype.setHtmlType=function(t){let e=R[t];e?this.updateHTML(e):console.error(`html type ['${t}'] is not register`)};const H={linkName:"",nodeName:"节点名称",nodeBackgroundColor:"#fff",nodeStrokeWith:"3",themeColor:"#409eff",completeColor:"green",completeConnectColor:"green"},V="Business",Y={grid:!0,background:null,width:"100%",height:"100%",menu:!0,toolbar:!1,enablePropertyPop:!0,pathStyle:"broken",maxPathTextWidth:100,nowrap:!1,panable:!0,editable:!0,uuid:!0,disableAlignLine:!1,enableHistory:!0,defaultConditionType:"Script",zoomable:!0,overviewOffsetWidth:60,overviewOffsetHeight:20,alertMessage(t){alert(t)},clickElement(t,e){},dblclickElement(t,e){},clickBlank(t){},dblclickBlank(t){},contextMenu(t){},onConnectCreated(t){},onNodeCreated(t){},onRemoveElement(t){},settings:H},U=(t,e)=>{"function"==typeof e.option.onNodeCreated&&e.option.onNodeCreated.call(e,t,e)};class G{constructor(t,e){"string"==typeof t&&(t=document.querySelector(t)),this.option=Object.assign({},Y,e||{}),this.option.settings?this.option.settings=Object.assign({},H,this.option.settings):this.option.settings=H;let{width:i="100%",height:a="100%"}=this.option,n={position:"relative",overflow:this.option.overflow||"hidden"};Object.assign(t.style,n),t.innerHTML='\n    <div class="flow-menu" style="display:none;z-index: 100;">\n        <div class="menu-item" data-type="select" draggable="true" title="圈选，可使用快捷键按住ctrl替代"></div>\n        <div class="menu-item" data-type="start" draggable="true" title="开始"></div>\n\x3c!--        <div>开始</div>--\x3e\n        <div class="menu-item" data-type="task" draggable="true" title="任务节点"></div>\n\x3c!--        <div>任务</div>--\x3e\n        <div class="menu-item" data-type="end" draggable="true" title="结束"></div>\n        \x3c!--        <div>结束</div>--\x3e\n        <div style="border: 1px dashed #dcdfe6; width: 40%;margin: 8px;opacity: .7;"></div>\n        <div class="menu-item" data-type="xor" draggable="true" title="有且仅有一个满足条件的分支通过"></div>\n\x3c!--        <div>分支</div>--\x3e\n        <div class="menu-item" data-type="or" draggable="true" title="至少一个满足条件的分支通过,与汇聚网关组合使用"></div>\n\x3c!--        <div>分支</div>--\x3e\n        <div class="menu-item" data-type="and" draggable="true" title="所有分支强制通过,与汇聚网关组合使用"></div>\n\x3c!--        <div>分支</div>--\x3e\n        <div class="menu-item" data-type="join" draggable="true" title="汇聚网关"></div>\n        <div style="border: 1px dashed #dcdfe6; width: 40%;margin: 8px;opacity: .7;"></div>\n\x3c!--        <div>聚合</div>--\x3e\n\x3c!--        <div class="menu-item" data-type="selection"></div>--\x3e\n\x3c!--        <div>圈选</div>--\x3e\n        <div class="menu-item" data-type="reset" title="重置"></div>\n\x3c!--        <div>重置</div>--\x3e\n        <div class="menu-item" data-type="imp" title="导入"></div>\n\x3c!--        <div>导入</div>--\x3e\n        <div class="menu-item" data-type="exp" title="导出"></div>\n\x3c!--        <div>导出</div>--\x3e\n\x3c!--        <div class="menu-item" data-type="picture" title="导出图片"></div>--\x3e\n\x3c!--        <div>图片</div>--\x3e\n    </div>\n    <div class="flow-popwin" style="display:none;font-size: 12px; position: fixed;background: #fff; right: 40px; width: 300px; overflow: auto;box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);z-index: 100;">\n       <div>\n            <span class="close-handle" style="color:red;float: right;cursor: pointer;" title="关闭">x</span>\n            <h4>基本属性</h4>\n       </div>\n       <form class="flow-property-form">\n       </form>\n    </div>\n    <div class="flow-wrapper" style="position: absolute;width: 100%; height: 100%;left: 0; top: 0">\n       <div class="flow-wrapper-body"  style="position: relative;width: 100%;height: 100%;">\n            <div class="flow-edit-input" contenteditable style="min-width: 50px; height: 24px; display: none;position: absolute;font-size: 13px;background: #fff;transform: translate(-50%, -50%);outline: 1px solid transparent;z-index: 100;"></div>\n       </div>\n    </div>\n    \n    <div class="flow-tools" style="display:none;z-index: 100;">\n        <div class="tool-item" data-type="overview" draggable="true" title="大纲，全貌视图"></div>\n        <div class="tool-item" data-type="zoomReset" draggable="true" title="初始大小"></div>\n        <div class="tool-item" data-type="zoomIn" draggable="true" title="放大"></div>\n        <div class="tool-item" data-type="zoomOut" draggable="true" title="缩小"></div>\n    </div>\n    \n    <input class="flow-import-input" type="file" accept=".json" style="position: absolute;display:none;opacity: 0; width: 0; height: 0; border: unset;"/>\n',this.option.menu&&this.initMenu(t.children[0]),this.initInput(t.querySelector(".flow-edit-input")),this.initPopwin(t.querySelector(".flow-popwin")),this.initFileInput(t.querySelector(".flow-import-input"));let o=t.querySelector(".flow-wrapper .flow-wrapper-body");this.flowWrapper=o,this.paper=new P(o,i,a),Object.assign(this.paper.canvas.style,{userSelect:"none",cursor:"default",overflow:"visible"}),this.connectColors=[this.option.settings.themeColor],this.initPaper(),this.dom=t,this.init(),this.setStyles(),this.elements={},this.containers={},this.groupSelectElements=[],this.designMode="Simple",this.selectElement=null,this.idPool=[];let r=this,l=t=>r.setElementUUID(t);this.nodeDatas={gateway:"XOR",handler:{},uuid:l,meta:{}},this.connectDatas={priority:0,conditionType:"Script",script:"",uuid:l,meta:{},pathStyle:"broken"},this.initControlElements(),this.translateX=0,this.translateY=0,this.offsetX=0,this.offsetY=0,this.scaleValue=1}initControlElements(){let t=this,e=function(e,i,a,n){t.resizeOnMove(this,e,i,a,n)},i=function(){t.resizeOnStart(this),t.dragingElement=this},n=function(){t.dragingElement=null},o={fill:"#ffffff",stroke:this.option.settings.themeColor},d=this.nw=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"nw-resize"})),h=this.w=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"w-resize"})),c=this.sw=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"sw-resize"})),p=this.n=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"n-resize"})),u=this.s=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"s-resize"})),g=this.ne=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"ne-resize"})),m=this.e=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"e-resize"})),f=this.se=this.paper.rect(0,0,5,5,2.5,2.5).attr(a(a({},o),{cursor:"se-resize"}));d.data("direction","nw").data("diagonal",f).drag(e,i,n).hide(),h.data("direction","w").data("diagonal",m).drag(e,i,n).hide(),c.data("direction","sw").data("diagonal",g).drag(e,i,n).hide(),p.data("direction","n").data("diagonal",u).drag(e,i,n).hide(),u.data("direction","s").data("diagonal",p).drag(e,i,n).hide(),g.data("direction","ne").data("diagonal",c).drag(e,i,n).hide(),m.data("direction","e").data("diagonal",h).drag(e,i,n).hide(),f.data("direction","se").data("diagonal",d).drag(e,i,n).hide(),o={stroke:"#1DC967","stroke-width":2},this.dropNw=this.paper.path("").attr(a({},o)).hide(),this.dropNe=this.paper.path("").attr(a({},o)).hide(),this.dropSw=this.paper.path("").attr(a({},o)).hide(),this.dropSe=this.paper.path("").attr(a({},o)).hide(),this.dashOuterPath=this.paper.path("").hide(),this.dashOuterPath.node.setAttribute("stroke-dasharray","2 2"),this.groupSelection=this.renderRect(0,0,0,0,4).attr({fill:"transparent",cursor:"move","stroke-width":2}).hide(),this.groupSelection.node.setAttribute("stroke-dasharray","8 8"),this.dragableGroupSelection(),this.groupSelection.click((function(e){t.showGroupSelectionTool(),y(e)})),this.horizontalLine=this.renderRect(0,0,0,1e-4).attr({stroke:this.option.settings.themeColor,"stroke-width":2,opacity:.5}).hide(),this.horizontalLine.node.setAttribute("stroke-dasharray","12 12"),this.verticalLine=this.renderRect(0,0,1e-4,0).attr({stroke:this.option.settings.themeColor,"stroke-width":2,opacity:.5}).hide(),this.verticalLine.node.setAttribute("stroke-dasharray","12 12"),this.connectRect=this.renderRect(0,0,0,0).attr({fill:"transparent","stroke-width":1,stroke:this.option.settings.themeColor,opacity:.5}).hide(),this.connectRect.node.setAttribute("stroke-dasharray","2 2"),this.connectRect.hover((()=>{}),(function(){this.hide()})).click((function(e){y(e);let i=this.data("target");i&&t.handleClickElement(i,e)})).dblclick((function(e){y(e);let i=this.data("target");i&&t.handleDblclickElement(i,e)})),this.linkTool=this.paper.image(r,0,0,16,16).hide(),this.linkTool.attr({opacity:.5,title:"拖拽到目标节点完成连线"}).mouseover((function(){this.attr("opacity",1)})).mouseout((function(){this.attr("opacity",.5)})),this.linkTool.drag((function(e,i,a,n,o){t.linkToolOnDragMove(this,e,i,a,n,o)}),(function(){t.dragingElement=t.linkTool}),(function(){t.linkToolOnDragUp(this),t.dragingElement=null})),this.nextTaskTool=this.paper.image(l,0,0,16,16).attr({opacity:.5,title:"快速追加下一个任务",cursor:"pointer"}).mouseover((function(){this.attr("opacity",1),t.dragingElement={}})).mouseout((function(){this.attr("opacity",.5),t.dragingElement=null})).hide(),this.nextTaskTool.click((function(e){t.nextNode()})),this.nextSplitTool=this.paper.image(s,0,0,16,16).attr({opacity:.5,title:"快速追加分支任务",cursor:"pointer"}).mouseover((function(){this.attr("opacity",1),t.dragingElement={}})).mouseout((function(){this.attr("opacity",.5),t.dragingElement=null})).hide(),this.nextSplitTool.click((function(e){t.nextSplit()})),this.nextEndTool&&this.nextEndTool.remove(),this.nextEndTool=this.renderHTML("end",0,0,16,16).attr({opacity:.5,title:"快速追加结束任务",cursor:"pointer"}).mouseover((function(){this.attr("opacity",1),t.dragingElement={}})).mouseout((function(){this.attr("opacity",.5),t.dragingElement=null})).hide(),this.nextEndTool.click((function(e){t.nextEnd()})),this.deleteTool&&this.deleteTool.remove(),this.deleteTool=this.renderHTML("del",0,0,16,16).attr({opacity:.5,title:"删除元素",cursor:"pointer"}).mouseover((function(){this.attr("opacity",1),t.dragingElement={}})).mouseout((function(){this.attr("opacity",.5),t.dragingElement=null})).hide(),this.deleteTool.click((function(e){t.deleteTool.data("host")?t.deleteSelectElement():t.deleteGroupSelectElements(),t.deleteTool.hide()}))}dragableGroupSelection(){let t=this,e=this.groupSelection,i={ox:0,oy:0,dx:0,dy:0};e.drag(((a,n)=>{if(!t.option.editable)return;let o=t.scaleValue||1;a/=o,n/=o;let r={x:i.ox+a,y:i.oy+n};e.attr(r);let l=a-i.dx,s=n-i.dy;i.dx=a,i.dy=n,t.elementsPanTo(this.groupSelectElements,l,s)}),(a=>{if(t.option.editable)return t.dragingElement=e,i.ox=e.attr("x"),i.oy=e.attr("y"),e.attr({opacity:.8}),e.attr("cursor","move"),t.hideEditElements(t.selectElement),t.enableHistory()&&(i.undoData=JSON.stringify(t.getData())),!1}),(()=>{if(t.option.editable){if(t.dragingElement=null,e.attr({opacity:1}),t.enableHistory()){let e=JSON.stringify(t.getData()),a=i.undoData;t.addAction({undo:()=>t.setData(a),redo:()=>t.setData(e)})}i={ox:0,oy:0,dx:0,dy:0}}}))}nextNode(){let t=this.nextTaskTool.data("from");if(!t)return;let{x:e,y:i,width:a,height:n}=t.attrs,o=i+n/2,r=this.createNode(e+a+150,i);r.data("nodeType",V);let{height:l}=r.attrs;r.attr({y:o-l/2}),this.updateElements(r);let s=this.createPath(t,r);this.hideEditElements(s)}nextSplit(){let t=this.nextSplitTool.data("from");if(!t)return;let e="AND"==t.data("gateway");console.log(e),console.log(t.data("gateway"));let{x:i,y:a,width:n,height:o}=t.attrs,r=a+o/2,l=this.createNode(i+n+150,a);l.data("nodeType",V);let{height:s}=l.attrs;l.attr({y:r-s/2-100}),this.updateElements(l);let d=this.createPath(t,l);e||this.setConnectType(d,this.option.defaultConditionType||"Script"),this.hideEditElements(d);let h=this.createNode(i+n+150,a);h.data("nodeType",V);let{height:c}=h.attrs;h.attr({y:r-c/2+100}),this.updateElements(h);let p=this.createPath(t,h);e||this.setConnectType(p,this.option.defaultConditionType||"Script"),this.hideEditElements(p)}nextEnd(){let t=this.nextTaskTool.data("from");if(!t)return;let{x:e,y:i,width:a,height:n}=t.attrs,o=i+n/2,r=this.createEndNode(e+a+150,i),{height:l}=r.attrs;r.attr({y:o-l/2}),this.createPath(t,r)}setContainerStyle(t){let e=this.flowWrapper;t&&"object"==typeof t&&Object.assign(e.style,t)}setStyles(){let t={position:"relative",overflow:this.option.overflow||"hidden"};this.option.background?t.background=`${this.option.background}`:this.option.grid&&(t.background=`url("${o}")`),Object.assign(this.dom.style,t)}initMenu(t){let e=this;this.menu=t,Object.assign(t.style,{position:"absolute",left:"0px",top:"0px",width:"64px",display:"flex",flexDirection:"column",alignItems:"center",fontSize:"14px",color:this.option.settings.themeColor,padding:"5px 5px 20px",background:"hsla(0,0%,100%,.9)",boxShadow:"0 1px 4px rgba(0,0,0,.3)",userSelect:"none"});const i={dragmenu:!1,type:null,element:null},a=(a,n)=>{const{pageX:o,pageY:r}=a;let l=n==t;if(!l){let t=n.dataset.type;i.type=t}i.px=o,i.py=r;let{x:s,y:d,left:h,top:c}=e.dom.getBoundingClientRect(),p=s||h,u=d||c;i.offsetX=p,i.offsetY=u,i.dragmenu=l,l&&(i.left=Number(t.style.left.replace("px","")),i.top=Number(t.style.top.replace("px","")))},n=a=>{let{type:n,element:o,dragmenu:r,left:l,top:s}=i;const{pageX:d,pageY:h}=a;let c=d-i.px,p=h-i.py;if(r){let e=l+c<=0?0:l+c,i=s+p<=0?0:s+p;Object.assign(t.style,{left:`${e}px`,top:`${i}px`})}else{if(!o){let t=i.px-i.offsetX-20,a=i.py-i.offsetY-20;t=(t-e.offsetX)/(this.scaleValue||1),a=(a-e.offsetY)/(this.scaleValue||1),"task"==n?i.element=o=e.createBusinessNode(t,a):"start"==n?i.element=o=e.createStartNode(t,a):"end"==n?i.element=o=e.createEndNode(t,a):"xor"==n?(i.element=o=e.createSplitNode(t,a),i.element.data("gateway","XOR")):"or"==n?(i.element=o=e.createSplitNode(t,a),i.element.updateHTML(j.or),i.element.data("gateway","OR")):"and"==n?(i.element=o=e.createSplitNode(t,a),i.element.updateHTML(j.and),i.element.data("gateway","AND")):"join"==n&&(i.element=o=e.createJoinNode(t,a)),e.selectElement=o,e.elementDragStart(o)}e.elementDragMove(o,c,p)}},o=t=>{if(i.element){let t=i.element;t.attr({opacity:1}),e.handleElementAction(t)}delete i.type,delete i.element,delete i.dragmenu,e.hideAlignLines(),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};"object"==typeof this.option.menu&&this.option.menu.draggable&&(Object.assign(t.style,{cursor:"move"}),g(t,"mousedown",(function(e){a(e,t),document.addEventListener("mousemove",n),document.addEventListener("mouseup",o),y(e)}))),t.querySelectorAll(".menu-item").forEach((t=>{let i=t.dataset.type,r=36,l=36;"or"!=i&&"xor"!=i&&"and"!=i&&"join"!=i||(r=45,l=45),Object.assign(t.style,{width:`${r}px`,height:`${l}px`,margin:"10px 0 4px 0"}),"select"==i?(t.style.cursor="pointer",t.innerHTML=j.select,g(t,"click",(function(t){e.groupSelectionMode=!0,e.paper.canvas.style.cursor="crosshair",y(t)}))):"reset"==i?(t.style.cursor="pointer",t.innerHTML=j.reset,g(t,"mousedown",(function(t){y(t)})),g(t,"click",(function(t){e.reset(),y(t)}))):"exp"==i?(t.style.cursor="pointer",t.innerHTML=j.exp,g(t,"mousedown",(function(t){y(t)})),g(t,"click",(function(t){e.exportJSON(),y(t)}))):"imp"==i?(t.style.cursor="pointer",t.innerHTML=j.imp,g(t,"mousedown",(function(t){y(t)})),g(t,"click",(function(t){e.handleImport(),y(t)}))):"picture"==i?(t.style.cursor="pointer",t.innerHTML=j.picture,g(t,"mousedown",(function(t){y(t)})),g(t,"click",(function(t){e.exportImage(),y(t)}))):(Object.assign(t.style,{cursor:"move"}),t.innerHTML=j[i],g(t,"mousedown",(function(e){a(e,t),document.addEventListener("mousemove",n),document.addEventListener("mouseup",o),y(e)})))}))}addAction(t){}setMenuStyle(t){"object"!=typeof t&&(t={}),this.menu&&Object.assign(this.menu.style,t||{})}setToolsStyle(t){"object"!=typeof t&&(t={}),this.flowToolsDom&&Object.assign(this.flowToolsDom.style,t||{})}initInput(t){let e=this;this.input=t,g(t,"input",(function(t){let i=t.target.innerText.replace(/[\s\r\n]/g,"");e.updateActiveText(i,!1)})),g(t,"blur",(function(t){e.endInputEdit()})),g(t,"mousedown",(function(t){e.disablePan=!0})),this.textElement=null}initPopwin(t){let e=this;this.popwin=t,Object.assign(t.style,{top:"150px",padding:"0 20px 20px",minHeight:"350px",display:"none"}),g(t.querySelector(".close-handle"),"click",(function(){e.closePopwin()})),g(t,"mousedown",(function(t){t.stopPropagation()})),this.propertyForm=t.querySelector(".flow-property-form")}openElementPropertyPop(t){if(!this.option.editable)return;let e=this,i=[];if(t){let a=t.type,n=t.data("nodeType");if(i=[{label:"元素ID",value:t.id,event:"input",readonly:!0,key:"id",html:'<input data-key="id"/>'}],"path"==a){let a=t.data("from").data("out"),n=1==Object.keys(a).length;i.push({label:"元素名称",value:t.data("text").attr("text")||"",event:"input",key:"name",html:'<input data-key="name" placeholder="请输入元素名称"/>',callback(i){e.setElementName(t,i)}},{label:"连线样式",value:t.data("pathStyle")||"",event:"input",key:"pathStyle",html:'<select data-key="pathStyle">\n                           <option value="broken">折线</option>\n                           <option value="straight">直线</option>\n\x3c!--                           <option value="h2v">h2v</option>--\x3e\n\x3c!--                           <option value="v2h">v2h</option>--\x3e\n\x3c!--                           <option value="curve">曲线</option>--\x3e\n                       </select>',callback(i){i!=t.data("pathStyle")&&(e.resetConnectPathData(t,i),t.data("pathStyle",i))}},{label:"分支策略",value:t.data("conditionType")||"Script",event:"change",key:"conditionType",html:'<select data-key="conditionType">\n                           <option value="Always">Always</option>\n                           <option value="Script">Script</option>\n                           <option value="HandlerCall">HandlerCall</option>\n                       </select>',callback(i){e.setConnectType(t,i)}},{label:"脚本表达式",value:t.data("script")||"",event:"input",key:"script",html:'<textarea data-key="script"></textarea>',readonly:n,callback(e){t.data("script",e)}},{label:"优先级",value:t.data("priority")||0,event:"input",key:"priority",html:'<input data-key="priority" type="number"/>',readonly:n,callback(e){t.data("priority",e?Number(e):0)}})}else switch(n){case"Start":case"End":case"Join":break;case"Split":i.push({label:"网关类型",value:t.data("gateway")||"XOR",event:"change",key:"gateway",html:'<select data-key="gateway">\n                               <option value="XOR">条件</option>\n                               <option value="OR">条件并行</option>\n                               <option value="AND">并行</option>\n                           </select>',callback(e){t.updateHTML(j[e.toLowerCase()]),t.data("gateway",e)}});break;default:{let e=t.data("handler");e||t.data("handler",e={}),t.data("text")&&i.push({label:"元素名称",value:t.data("text").attr("text")||"",event:"input",key:"name",html:'<input data-key="name" placeholder="请输入元素名称"/>',callback(e){t.data("text").attr("text",e)}}),i.push({label:"任务类型",value:t.data("nodeType")||"Business",event:"change",key:"nodeType",html:'<select data-key="nodeType">\n                               <option value="Business">Business</option>\n                               <option value="Service">Service</option>\n                               <option value="Script">Script</option>\n                               <option value="Manual">Manual</option>\n                           </select>',callback(e){t.data("nodeType",e)}},{label:"是否异步执行",value:e.asynchronous||!1,event:"change",key:"asynchronous",checkbox:!0,html:'<input data-key="asynchronous" type="checkbox">',callback(t){e.asynchronous=t}},{label:"超时设置",value:e.timeout||0,event:"input",key:"timeout",html:'<input type="number" data-key="timeout" placeholder="单位为毫秒"/>',callback(t){e.timeout=t?Number(t):0}},{label:"延迟设置",value:e.delay||0,event:"input",key:"delay",html:'<input data-key="delay" type="number" placeholder="单位为毫秒"/>',callback(t){e.delay=t?Number(t):0}},{label:"循环迭代次数",value:e.iterate||0,event:"input",key:"iterate",html:'<input data-key="iterate" type="number"/>',callback(t){e.iterate=t?Number(t):0}},{label:"失败策略",value:e.policy||"Stop",event:"change",key:"policy",html:'<select data-key="policy">\n                                       <option value="Stop">终止</option>\n                                       <option value="Continue">继续</option>\n                                   </select>',callback(t){e.policy=t}})}}}else i.push({label:"流程标识",value:e.processId||"",event:"input",key:"processId",html:'<input data-key="processId" placeholder="流程id"/>',callback(t){e.processId=t}},{label:"流程名称",value:e.processName||"",event:"input",key:"processName",html:'<input data-key="processName" placeholder="流程名称"/>',callback(t){e.processName=t}});let a=[],n={};for(let o of i){let{label:t,html:e,key:i}=o;a.push(`\n                 <div class="flow-form-item">\n                    <div>${t}</div>\n                    ${e}\n                 </div>\n            `),n[i]=o}this.propertyForm.innerHTML=a.join(""),this.propertyForm.querySelectorAll(".flow-form-item").forEach((t=>{Object.assign(t.style,{display:"flex",flexDirection:"column",margin:"8px",lineHeight:"28px"});let e=t.children[1];Object.assign(e.style,{height:"28px",lineHeight:"28px",border:"1px solid #dcdfe6"});let i=e.dataset.key,a=n[i];a.checkbox?a.value&&(e.checked=!0):e.value=a.value,a.readonly?e.setAttribute("disabled","disabled"):g(e,a.event,(function(t){let e=null;e=a.checkbox?!!t.target.checked:t.target.value,a.callback(e)}))})),this.popwin.style.display="block",this.disablePan=!0}resetConnectPathData(t,e){let i=t.data("from"),a=t.data("to");this.resetPathData(t,i,a,e)}closePopwin(){this.popwin&&(this.popwin.style.display="none",this.disablePan=!1)}beginInputEdit(t){if(this.option.editable&&t.data("text")){let e=t.data("text");this.textElement=e;let i=e.attr("text"),{x:a,y:n}=e.attrs;this.input.innerHTML=i,Object.assign(this.input.style,{left:a+"px",top:n+"px",display:"block"}),this.input.focus(),e.hide()}}endInputEdit(){this.input.innerText="",this.input.style.display="none",this.textElement&&this.textElement.show(),this.disablePan=!1}initFileInput(t){let e=this;this.fileInput=t,g(t,"change",(t=>{e.onImportFile(t)}))}initData(){this.elements={},this.containers={},this.idPool=[],this.groupSelectElements=[]}initPaper(){this.paper.canvas.querySelector("defs").innerHTML='\n    <path d="M5,0 0,2.5 5,5 3.5,3 3.5,2z" id="connect-arrow-path" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>\n';for(let t of this.connectColors||[])B(this.paper.canvas,t)}init(){let t=this;if(g(t.paper.canvas,"click",(e=>t.handleClickBlank(e))),g(t.paper.canvas,"contextmenu",(e=>t.handleContextmenu(e))),g(t.paper.canvas,"dblclick",(e=>t.handleDblClickBlank(e))),this.handleKeyboardEvents(),this.handleMouseDragMoveEvents(),this.setScaleable(this.option.zoomable),this.option.zoomable){let t=this,e=this.dom.querySelector(".flow-tools");this.flowToolsDom=e,Object.assign(e.style,{position:"absolute",right:"5px",top:"75%",transform:"translate(0, -50%)",width:"48px",display:"flex",flexDirection:"column",alignItems:"center",fontSize:"14px",color:this.option.settings.themeColor,padding:"5px",userSelect:"none"}),e.querySelectorAll(".tool-item").forEach((e=>{let i=e.dataset.type;Object.assign(e.style,{width:"36px",height:"36px",margin:"2px 0",cursor:"pointer",background:"hsla(0,0%,100%,.9)",boxShadow:"0 1px 4px rgba(0,0,0,.3)"}),e.innerHTML=j[i],g(e,"mousedown",(function(t){y(t)})),g(e,"click",(function(e){y(e),"overview"==i?t.overview():"zoomReset"==i?(t.zoomReset(),h&&t.triggerTextRefreshPos()):"zoomIn"==i?(t.zoomIn(),h&&t.triggerTextRefreshPos()):"zoomOut"==i&&(t.zoomOut(),h&&t.triggerTextRefreshPos())}))}))}}handleKeyboardEvents(){let t=this;this.handleDocumentKeyDown||(this.handleDocumentKeyDown=e=>{if(46==e.keyCode)t.deleteSelectElement();else if(8==e.keyCode){let t=document.activeElement;if(t.getAttribute&&"readonly"==t.getAttribute("readonly"))return!1}else 16==e.keyCode?t.shiftMode=!0:17==e.keyCode?(t.resetGroupSelection(),t.groupSelectionMode=!0,t.paper.canvas.style.cursor="crosshair"):89==e.keyCode?e.ctrlKey&&t.redo():90==e.keyCode&&e.ctrlKey&&t.undo()}),this.handleDocumentKeyUp||(this.handleDocumentKeyUp=e=>{16==e.keyCode&&(t.shiftMode=!1),17==e.keyCode&&(t.groupSelectionMode=!1,t.paper.canvas.style.cursor="default")}),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("keyup",this.handleDocumentKeyUp),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("keyup",this.handleDocumentKeyUp)}handleMouseDragMoveEvents(){let t=this;const e={moved:!1},i=i=>{const{pageX:a,pageY:n}=i;if(e.px=a,e.py=n,t.enableGroupSelection()){let{x:e,y:i,left:o,top:r}=t.dom.getBoundingClientRect(),l={x:a-(e||o||0),y:n-(i||r||0)},s=t.scaleValue||1;l.x=(l.x-t.offsetX)/s,l.y=(l.y-t.offsetY)/s,this.groupSelection.data("start",l)}else t.paper.canvas.style.cursor="grab",e.translateX=t.translateX,e.translateY=t.translateY},a=i=>{const{pageX:a,pageY:n}=i;let o=a-e.px,r=n-e.py;if(o*o+r*r>0&&(e.moved=!0),t.enableGroupSelection()){let{x:t,y:e}=this.groupSelection.data("start"),i=this.scaleValue||1;o/=i,r/=i;let a=o,n=r;o<0&&(t+=o,a=-o),r<0&&(e+=r,n=-r),this.groupSelection.attr({x:t,y:e,width:a,height:n,stroke:this.option.settings.themeColor}).show()}else t.translateX=e.translateX+o,t.translateY=e.translateY+r,t.cancelSelect(),t.translateTo(t.translateX,t.translateY)},n=i=>{try{t.enableGroupSelection()?t.showGroupSelection():t.panTo(t.translateX/this.scaleValue,t.translateY/this.scaleValue,!0),e.moved?t.connectRect.hide():t.resetGroupSelection(),t.groupSelectionMode=!1,e.moved=!1,t.paper.canvas.style.cursor="default"}finally{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",n)}};g(t.dom,"mousedown",(function(e){if(!t.dragingElement&&!t.disablePan){if(!t.enablePanable()&&!t.enableGroupSelection())return;i(e),t.endInputEdit(),document.addEventListener("mousemove",a),document.addEventListener("mouseup",n),y(e)}}))}triggerTextRefreshPos(){this.paper.canvas.querySelectorAll("text").forEach((t=>{let e=t.getAttribute("x");null!=e&&t.setAttribute("x",e)}))}setScaleable(t){let e=this;if(t){let t=t=>{(t.wheelDelta||-t.detail)>0?e.zoomIn():e.zoomOut(),y(t)};this.wheelEventFn=t,g(e.dom,"wheel",t)}}zoomIn(){this.setScale(this.scaleValue+.2)}zoomOut(){this.setScale(this.scaleValue-.2)}zoomReset(){this.setScale(1)}setScale(t){0==this.translateX&&0==this.translateY||this.panTo(this.translateX,this.translateY),t<=.01&&(t=.01),this.scaleValue=t,this.updateWrapperTransform()}overview(){let t=Object.values(this.elements),e=0,i=0,a=0,n=0,o=!0;for(let A of t){if("path"==A.type)continue;let{x:t,y:r,width:l,height:s}=A.attrs;o?(o=!1,e=t,i=r,a=t+l,n=r+s):(e=Math.min(e,t),i=Math.min(i,r),a=Math.max(a,t+l),n=Math.max(n,r+s))}let r=a-e,l=n-i,{width:s,height:d}=this.flowWrapper.parentNode.getBoundingClientRect(),h=e+r/2,c=i+l/2,p=s/2,u=d/2,{overviewOffsetWidth:g,overviewOffsetHeight:m}=this.option,y=s-2*g,f=d-2*m,x=1;(y<r||f<l)&&(x=Math.min(y/(r||1),f/(l||1)));let v=(p-h)*x,w=(u-c)*x;this.translateTo(v,w),this.setScale(x)}enableGroupSelection(){return this.option.editable&&this.groupSelectionMode}enablePanable(){return this.option.panable}enableHistory(){return this.option.enableHistory}showGroupSelectionTool(){this.cancelSelect();let{x:t,y:e,width:i,height:a}=this.groupSelection.attrs,n=t+i+5,o=e-5;this.deleteTool.attr({x:n,y:o}).data("host",null).show()}hideGroupSelectionTool(){this.deleteTool.hide()}showGroupSelection(){let t=this.groupSelection;if(!t||!t.attrs)return;let{x:e,y:i,width:a,height:n}=t.attrs;if(!(e&&i&&a&&n))return;let o=this.groupSelectElements=[],r=this.elements,l=[];for(let s in r){let e=r[s];if("path"!=e.type){if(this.isDropContainer(e,t)){o.push(e);let t=e.data("out");for(let e in t||{})l.includes(e)||(l.push(e),o.push(t[e]));let i=e.data("in");for(let e in i||{})l.includes(e)||(l.push(e),o.push(i[e]))}}}0==this.groupSelectElements.length?(this.groupSelection.hide(),this.groupSelectionVisible=!1):(this.groupSelection.show(),this.groupSelectionVisible=!0,this.showGroupSelectionTool())}resetGroupSelection(){this.groupSelection.hide(),this.groupSelectElements=[],this.groupSelectionVisible&&this.hideGroupSelectionTool()}cancelSelect(){let t=this.selectElement;t&&(this.hideEditElements(t),this.selectElement=null)}handleClickBlank(t){this.option.clickBlank&&this.option.clickBlank(t),this.cancelSelect(),this.closePopwin()}handleDblClickBlank(t){this.option.dblclickBlank&&this.option.dblclickBlank(t),this.option.enablePropertyPop&&this.openElementPropertyPop()}handleContextmenu(t){return this.option.onContextMenu&&this.option.onContextMenu(t),y(t),!1}setDesignMode(t){this.designMode=t}getDesignMode(){return this.designMode}uuid(){let t=[],e="0123456789abcdef";for(var i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}renderHTML(t,e,i,a,n){let o=null;if(!(o=R[t]))return void console.error(`html type [${t}] is not register `);let r=document.createElement("div");this.flowWrapper.appendChild(r),r.innerHTML=o,r.style.position="absolute";let l=new M(r);return l.attr({x:Number(e)||0,y:Number(i)||0,width:Number(a)||0,height:Number(n)||0}),l}renderSvgText(t,e){return this.paper.text(t,e)}renderHtmlText(t,e,i){let a=document.createElement("div");this.flowWrapper.appendChild(a),a.style.position="absolute";let n=new k(a,!!this.option.nowrap),o={x:Number(t)||0,y:Number(e)||0};return o["max-width"]=`${i}px`,n.attr(o),n}renderPathText(t,e,i,a,n){let o=document.createElement("div");this.flowWrapper.appendChild(o),o.style.position="absolute";let r=new k(o);return r.attr({x:Number(t)||0,y:Number(e)||0,width:Number(i)||0,height:Number(a)||0}),r.attr("text",n),r}setElementUUID(t){if(t&&this.option.uuid){let e=this.uuid();return t.data("uuid",e),e}return null}renderRect(...t){return this.paper.rect(...t)}renderCircle(t,e,i){return this.paper.circle(t,e,i)}renderImage(...t){return this.paper.image(...t)}renderPath(t,e){return this.paper.path(t).attr(e)}getCoordinate(t,e,i,a,n){if(i!=t)return n*(a-e)/(i-t)+(e*i-a*t)/(i-t);console.error("call getCoordinate error for x2 == x1")}getLinePathData(t,e){let i={},a="",n=t.attr("x")-5,o=t.attr("y")-5,r=t.attr("width")+10,l=t.attr("height")+10,s=e.attr("x")-5,d=e.attr("y")-5,h=e.attr("width")+10,c=e.attr("height")+10,p=n+r/2,u=o+l/2,g=s+h/2,m=d+c/2,y={},f={};if(g<p&&m<u){let t={};if(t.y=o,t.x=this.getCoordinate(u,p,m,g,t.y),t.x>=n)y=t;else{let t={};t.x=n,t.y=this.getCoordinate(p,u,g,m,t.x),y=t}let e={};if(e.y=d+c,e.x=this.getCoordinate(u,p,m,g,e.y),e.x>=s&&e.x<=s+h)f=e;else{let t={};t.x=s+h,t.y=this.getCoordinate(p,u,g,m,t.x),f=t}}else if(g<p&&m==u)y.x=n,y.y=u,f.x=s+h,f.y=m;else if(g<p&&m>u){let t={};if(t.y=o+l,t.x=this.getCoordinate(u,p,m,g,t.y),t.x>=n)y=t;else{let t={};t.x=n,t.y=this.getCoordinate(p,u,g,m,t.x),y=t}let e={};if(e.y=d,e.x=this.getCoordinate(u,p,m,g,e.y),e.x>=s&&e.x<=s+h)f=e;else{let t={};t.x=s+h,t.y=this.getCoordinate(p,u,g,m,t.x),f=t}}else if(g==p&&m<u)y.x=p,y.y=o,f.x=g,f.y=d+c;else if(g==p&&m>u)y.x=p,y.y=o+l,f.x=g,f.y=d;else if(g>p&&m<u){let t={};if(t.y=o,t.x=this.getCoordinate(u,p,m,g,t.y),t.x<=n+r)y=t;else{let t={};t.x=n+r,t.y=this.getCoordinate(p,u,g,m,t.x),y=t}let e={};if(e.y=d+c,e.x=this.getCoordinate(u,p,m,g,e.y),e.x>=s)f=e;else{let t={};t.x=s,t.y=this.getCoordinate(p,u,g,m,t.x),f=t}}else if(g>p&&m==u)y.x=n+r,y.y=m,f.x=s,f.y=m;else{let t={};if(t.y=o+l,t.x=this.getCoordinate(u,p,m,g,t.y),t.x<=n+r)y=t;else{let t={};t.x=n+r,t.y=this.getCoordinate(p,u,g,m,t.x),y=t}let e={};if(e.y=d,e.x=this.getCoordinate(u,p,m,g,e.y),e.x>=s)f=e;else{let t={};t.x=s,t.y=this.getCoordinate(p,u,g,m,t.x),f=t}}return a+="M"+y.x+","+y.y,a+="L"+f.x+","+f.y,i.data=a,i.start=y,i.end=f,i}distanceFromPointToLine(t,e,i,a,n,o){let r=Math.sqrt((t-i)*(t-i)+(e-a)*(e-a)),l=Math.sqrt((i-n)*(i-n)+(a-o)*(a-o)),s=Math.sqrt((n-t)*(n-t)+(o-e)*(o-e)),d=(r+l+s)/2;return 2*Math.sqrt(d*(d-r)*(d-l)*(d-s))/l}deleteGroupSelectElements(){let t=this,e=this.groupSelectElements;if(!e||0==e.length)return;let i=null,a=this.enableHistory();a&&(i=JSON.stringify(this.getData()));for(let n of e)!0!==n.removed&&this.removeElement(n);if(a){let e=JSON.stringify(this.getData());this.addAction({undo(){t.setData(i)},redo(){t.setData(e)}})}this.resetGroupSelection()}deleteSelectElement(){if(this.selectElement){let t=this,e=this.selectElement,i=null,a=null;if(this.enableHistory()){let{in:n={},out:o={}}=e.data();if("path"==e.type||0==Object.keys(n).length&&0==Object.keys(o).length){let a=e.id,n=this.toElementData(e);i={undo(){t.fromElementData(n)},redo(){t.deleteElementById(a)}},this.addAction(i)}else a=JSON.stringify(this.getData())}if(this.removeElement(this.selectElement),this.selectElement=null,this.enableHistory()&&null==i){let e=JSON.stringify(this.getData());this.addAction({undo(){t.setData(a)},redo(){t.setData(e)}})}}}deleteElementById(t){let e=this.getElementById(t);e&&this.removeElement(e)}removeElement(t){this.selectElement==t&&this.hideEditElements(t);let e=t.type,i=t.data(),a=this;if(setTimeout((()=>{try{"function"==typeof a.option.onRemoveElement&&a.option.onRemoveElement(t)}catch(e){}}),0),"path"==e){let e=t.data("from"),i=t.data("to");if(e&&e.data("out")){delete e.data("out")[t.id]}if(i&&i.data("in")){delete i.data("in")[t.id]}this.removePathRelationRects(t),t.data("text").remove();let a=t.id;t.remove(),this.unregisterElement(a)}else{for(let t in i){let e=i[t];if("container"!=t&&e&&e.remove&&e.remove(),("in"==t||"out"==t)&&e&&e instanceof Object)for(let t in e)this.removeElement(e[t]),delete e[t]}let e=t.id,a=i.type,n=i.container;if("mutiSubProcess"==a||"serviceGroup"==a){let e=this.containers[t.id],i=e.elements;for(let t in i){let e=i[t];this.removeElement(e)}this.removeContainer(e)}else this.unregisterElement(e);n&&this.unbindElementFromContainer(t,n),t.remove()}}removePathRelationRects(t){let e=t&&t.data("start");if(e){let t=e.data("right");for(e.remove();t;){let e=t,i=e.data("leftRect");i.undrag(),i.remove(),t=t.data("right"),e.undrag(),e.remove()}}}bindSelectEvent(t){let e=this;t.click((function(i){y(i),e.handleClickElement(t,i)})),t.data("text")&&(t.data("text").click((function(i){e.beginInputEdit(t),y(i)})),t.data("text").dblclick((function(i){e.beginInputEdit(t),y(i)}))),t.dblclick((function(i){y(i),e.handleDblclickElement(t,i)})),"path"==t.type&&t.hover((function(){let i=e.getConnectBoundRect(t);e.connectRect.attr(i).show(),e.connectRect.data("target",t)}),(function(){}))}handleClickElement(t,e){let i=this,a=i.selectElement;a&&i.hideEditElements(a),i.showEditElements(i.selectElement=t),i.option.clickElement&&i.option.clickElement(t,e)}handleDblclickElement(t,e){this.option.dblclickElement&&this.option.dblclickElement(t,e),this.beginInputEdit(t),this.option.enablePropertyPop&&this.openElementPropertyPop(t)}bindMouseOverOutEvent(t){let e=t.type,i=this;if("rect"==e||"image"==e||"html"==e){"Start"!=t.data("nodeType")&&t.mouseover((function(){i.dropNode=null,i.dragingLine&&(i.showDropRect(t),i.dropNode=this)})).mouseout((function(){i.hideDropRect(),this.attr("cursor","default"),i.dropNode=null}))}}showDropRect(t){let{dropNw:e,dropNe:i,dropSw:a,dropSe:n}=this,{x:o,y:r,width:l,height:s}=t.attrs,d=o-5,h=r-5,c=o+l+5,p=r+s+5;e.attr("path","M"+(d+5)+","+h+"H"+d+"V"+(h+5)).show(),i.attr("path","M"+(c-5)+","+h+"H"+c+"V"+(h+5)).show(),a.attr("path","M"+(d+5)+","+p+"H"+d+"V"+(p-5)).show(),n.attr("path","M"+(c-5)+","+p+"H"+c+"V"+(p-5)).show()}hideDropRect(){let{dropNw:t,dropNe:e,dropSw:i,dropSe:a}=this;t.hide(),e.hide(),i.hide(),a.hide()}translateTo(t,e){this.translateX=t,this.translateY=e,this.updateWrapperTransform()}updateWrapperTransform(){let t=this.translateX,e=this.translateY,i=this.scaleValue||1;Object.assign(this.flowWrapper.style,{transform:`translate(${t}px, ${e}px) scale(${i})`});let a=this.flowWrapper.parentNode,{left:n,top:o}=a.getBoundingClientRect(),{left:r,top:l}=this.flowWrapper.getBoundingClientRect();this.offsetX=r-n,this.offsetY=l-o}elementsPanTo(t,e,i){for(let a in t){let n=t[a];this.moveTo(n,e,i)}for(let a in t){let e=t[a];"path"==e.type&&this.updateLine(e)}}panTo(t,e,i){if(this.hideEditElements(null),this.enableHistory()&&i){let i=this;this.addAction({undo(){i.panTo(-t,-e,!1)},redo(){i.panTo(t,e,!1)}})}this.translateTo(0,0),this.elementsPanTo(this.elements,t,e),this.moveTo(this.groupSelection,t,e)}moveTo(t,e,i){if(!t||!t.type)return;if("path"==t.type){let a=t&&t.data("start");if(a){this.moveTo(a,e,i);let t=a.data("right");for(;t;){this.moveTo(t,e,i);let a=t.data("leftRect");this.moveTo(a,e,i),t=t.data("right")}}}else{let{x:a,y:n}=t.attrs;t.attr({x:a+e,y:n+i})}let a=t.data("text");a&&a.attr({x:a.attr("x")+e,y:a.attr("y")+i})}setPanable(t){this.option.panable=!!t}getContextMenuFn(t){}createStartNode(t,e){return this.createHTMLNode("start",t||100,e||150,48,48,"Start").attr({color:this.option.settings.themeColor})}createEndNode(t,e){return this.createHTMLNode("end",t||100,e||150,48,48,"End").attr({color:this.option.settings.themeColor})}createSplitNode(t,e){return this.createHTMLNode("xor",t||100,e||150,64,64,"Split").attr({color:this.option.settings.themeColor})}createJoinNode(t,e){return this.createHTMLNode("join",t||100,e||150,64,64,"Join").attr({color:this.option.settings.themeColor})}createHTMLNode(t,e,i,a,n,o){let r=this.renderHTML(t,e,i,a,n);return r?(this.setElementUUID(r),U(r,this),r.data("handler",{}),r.data("nodeType",o),r.attr("title",o+":"+r.id),this.autoContainerSelect(r),this.initElement(r),r):null}createNode(t,e,i,a){i=i||100,a=a||80;let n=this.renderRect(t,e,i||100,a||80,4);this.setElementUUID(n),n.attr({stroke:this.option.settings.themeColor,"stroke-width":this.option.settings.nodeStrokeWith,title:"id:"+n.id,fill:this.option.settings.nodeBackgroundColor}),n.data("handler",{});let o=this.renderHtmlText(0,0,.8*i).attr({text:this.option.settings.nodeName+" "+this.nextId()});return n.data("text",o),U(n,this),this.autoContainerSelect(n),this.initElement(n),n}handleElementAction(t){if(t&&this.enableHistory()){let e=this,i=t.id,a=this.toElementData(t);this.addAction({undo(){e.deleteElementById(i)},redo(){e.fromElementData(a)}})}}createBusinessNode2(t,e){return this.createHTMLNode("business",t||100,e||150,100,80,V).attr({borderColor:this.option.settings.themeColor})}createBusinessNode(t,e){let i=this.createNode(t,e);return i.data("nodeType",V),i}createNodeElement(t){let{id:e,type:i,component:a}=t,{type:n,attrs:o,textAttrs:r}=a,l=null;"rect"==n&&(l=this.renderRect(0,0,0,0,0)),l.id=e,o.rx&&(l.attrs.r=o.rx),l.data("nodeType",i),l.attr(o);let s=this.renderHtmlText(0,0,.8*o.width).attr(r);return l.data("text",s),l.attr("title","id:"+e),this.initElement(l),l}loadHTMLElement(t,e,i,a){let{attrs:n}=i,o=this.renderHTML(e,0,0,0,0);return o.id=t,o.data("nodeType",a),o.attr(n),o.attr("title","id:"+o.id),this.initElement(o),o}loadImageElement(t,e,i,a){let{attrs:n}=i;n.src=e;let o=this.renderImage("",0,0,0,0);return o.id=t,o.data("nodeType",a),o.attr(n),o.attr("title","id:"+o.id),this.initElement(o),o}createConnectElement(t,e,i){let{id:a,component:n}=t,{attrs:o,textAttrs:r}=n,l=this.paper.path("").attr(o);l.id=a,this.setConnectArrow(l);let s=this.renderHtmlText(0,0,this.option.maxPathTextWidth||100).attr(r);l.data("text",s),l.data("from",e),l.data("to",i);let d=e.data("out")||{};d[a]=l,e.data("out",d);let h=i.data("in")||{};h[a]=l,i.data("in",h);let c,p,u=function(t){if(Array.isArray(t))return t;let e=[];try{if("string"==typeof t){let i=null,a=[],n=-1;for(let o=0,r=t.length;o<r;++o){let r=t.charAt(o);switch(r){case"M":case"L":case"H":case"V":case"h":case"v":i&&(a.push(parseFloat(t.substring(n,o).trim())),e.push([i,...a])),a=[],i=r,n=o+1;break;case",":a.push(parseFloat(t.substring(n,o).trim())),n=o+1}}if(i){a.push(parseFloat(t.substring(n).trim()));let o=[i];o.push(...a),e.push(o)}}}catch(i){console.error(i)}return e}(o.path||o.d),g=u.length,m=[];for(let y=0;y<g;y++){let t=u[y],a=this.createControlDragRect(t[1],t[2],l);if(a.data("controlPointIndex",-1),m.push(a),0==y)c=a,c.data("fromNode",e),c.data("type","start"),l.data("start",c);else{let t=m[y-1];t.data("right",a),a.data("left",t);let e=this.createControlDragRect((t.attr("x")+a.attr("x")+5)/2,(t.attr("y")+a.attr("y")+5)/2,l);e.data("controlPointIndex",0),e.data("left",t),e.data("right",a),t.data("rightRect",e),a.data("leftRect",e)}y==g-1&&(p=a,p.data("toNode",i),p.data("type","end"),l.data("end",p))}return this.hideEditElements(l),this.bindSelectEvent(l),this.registerElement(l),l}createPath(t,e){let i=this.option.settings.themeColor,a=this.paper.path("").attr({stroke:i,"stroke-width":2});this.setConnectArrow(a,i),this.setElementUUID(a);let n=this.option.pathStyle||"broken";a.data("pathStyle",n),a.data("from",t),a.data("to",e);let o=t.data("out")||{};o[a.id]=a,t.data("out",o);let r=t.data("nodeType"),l="AND"==t.data("gateway"),s=Object.keys(o).length>1&&!l;var d,h;s||"Split"!=r||l||(s=!0),s?this.setConnectType(a,this.option.defaultConditionType||"Script"):this.setConnectType(a,"Always"),d=a,"function"==typeof(h=this).option.onConnectCreated&&h.option.onConnectCreated.call(h,d,h);let c=e.data("in")||{};return c[a.id]=a,e.data("in",c),this.resetPathData(a,t,e,n),this.bindSelectEvent(a),this.hideEditElements(null),this.selectElement=a,this.registerElement(a),this.handleElementAction(a),a}resetPathData(t,e,i,a){this.removePathRelationRects(t);let n=this.getLinePathData(e,i,!1),o=n.start,r=n.end;t.attr("path",n.data),t.data("pathStyle",a);let l=o.x,s=o.y,d=r.x,h=r.y,c=(l+d)/2,p=(s+h)/2;switch(a){case"broken":{let a=this.createControlDragRect(l,s,t),n=this.createControlDragRect(d,h,t);a.data("fromNode",e),n.data("toNode",i),t.data("start",a),t.data("end",n),a.data("right",n),n.data("left",a),a.data("type","start"),n.data("type","end");let o=this.createControlDragRect(c,p,t);o.data("controlPointIndex",0),o.data("left",a),o.data("right",n),a.data("rightRect",o),n.data("leftRect",o);break}}let u=t.data("text");u?u.attr({x:c-2.5-10,y:p-2.5-10}):(u=this.renderHtmlText(c-2.5-10,p-2.5-10,this.option.maxPathTextWidth||100).attr({text:this.option.settings.linkName||" "}),t.data("text",u))}getConnectBoundRect(t){if("path"!=t.type)return null;if("function"==typeof t.getBBox){let{x:e,y:i,width:a,height:n}=t.getBBox();return{x:e-5,y:i-5,width:a+10,height:n+10}}let e,i,a,n,o=t.attr("path"),r=0,l=0;for(let s of o){let t,o,d=!1;switch(s[0]){case"M":case"L":t=s[1],o=s[2];break;case"H":t=s[1],o=l;break;case"V":t=r,o=s[1];break;case"h":t=r+s[1],o=l;break;case"v":t=r,o=l+s[1];break;default:d=!0}if(d)break;void 0===e?(e=a=t,i=n=o):(e=Math.min(e,t),i=Math.min(i,o),a=Math.max(a,t),n=Math.max(n,o)),r=t,l=o}return{x:e-5,y:i-5,width:a-e+10,height:n-i+10}}createControlDragRect(t,e,i){let a=this.renderRect(t-2.5,e-2.5,5,5,2.5,2.5).attr({fill:"#ffffff",stroke:this.option.settings.themeColor,cursor:"move"});a.data("type","center"),i&&a.data("host",i);let n=this;return a.drag((function(t,e,i,a){n.controlOnMove(this,t,e,i,a)}),(function(){n.controlOnStart(this),n.dragingElement=this}),(function(){n.controlOnUp(this),n.dragingElement=null})),a}controlOnMove(t,e,i,a,n){t.attr({x:t.ox+e,y:t.oy+i});let o=t.data("type"),r=t.data("host");if(r.data("container")&&this.relativePosition(t,r.data("container")),"start"==o){t.hide();let e=t.data("right");t.data("rightRect").attr({x:(t.attr("x")+e.attr("x"))/2,y:(t.attr("y")+e.attr("y"))/2}),this.updatePath(r)}else if("end"==o){t.hide();let e=t.data("left");t.data("leftRect").attr({x:(t.attr("x")+e.attr("x"))/2,y:(t.attr("y")+e.attr("y"))/2}),this.updatePath(r)}else this.updatePathByControlRect(t);this.validateDropLink(r,"start"==o)}controlOnStart(t){t.ox=t.attr("x"),t.oy=t.attr("y"),t.data("dragging",!0);let e=t.data("host"),i=t.data("type");"start"!=i&&"end"!=i||(this.dragingLine=e)}controlOnUp(t){t.data("disableRestore",null),t.data("restore")&&(t.data("restore",null),t.data("controlPointIndex",0));let e=t.data("type"),i=t.data("host"),a=this.dropNode;if(a){if(!this.validateDropLink(i,"start"==e))return this.updatePathBound(i),this.updatePath(i),void(this.dragingLine=null);let n=i;if("start"==e){t.show();let e=t.data("fromNode");e.data("out")&&delete e.data("out")[n.id];let i=a;n.data("from",i),t.data("fromNode",i);let o=i.data("out")||{};o[n.id]=n,i.data("out",o),this.updatePathBound(n),this.updatePath(n)}else if("end"==e){t.show();let e=n.data("to");e.data("in")&&delete e.data("in")[n.id];let i=a;n.data("to",i),t.data("toNode",i);let o=i.data("in")||{};o[n.id]=n,i.data("in",o),this.updatePathBound(n),this.updatePath(n)}}else this.updatePathBound(i),this.updatePath(i);this.dragingLine=null}dragableElement(t){let e=this,i={moved:!1};t.drag(((a,n)=>{if(e.option.editable){if(!i.moved){if(!(a*a+n*n>0))return;i.moved=!0}e.elementDragMove(t,a,n)}}),(a=>{if(e.option.editable)return e.elementDragStart(t),e.dragingElement=t,e.enableHistory()&&(i.undoData=JSON.stringify(e.getData())),!1}),(()=>{if(e.option.editable){if(e.dragingElement=null,t.attr({opacity:1}),e.hideAlignLines(),e.enableHistory()&&i.moved){let t=JSON.stringify(e.getData()),a=i.undoData;e.addAction({undo:()=>e.setData(a),redo:()=>e.setData(t)})}i={}}}))}getVisibleNodes(){let t=this.elements,e=[];for(let i of Object.values(t))"path"!=i.type&&e.push(i);return e}handleAlignLines(t){if(!this.option.disableAlignLine&&t)try{let{x:e,y:i,width:a,height:n}=t.attrs,o={x:e+a/2,y:i+n/2},r=this.getVisibleNodes(),l=!1,s=!1,d=0,h=0;for(let c of r){if(c==t)continue;let{x:e,y:i,width:a,height:n}=c.attrs,r={x:e+a/2,y:i+n/2},p=o.x-r.x,u=o.y-r.y;!s&&p*p<25&&(s=!0,d=r.x),!l&&u*u<25&&(l=!0,h=r.y)}l?(this.horizontalLine.attr({width:"100%",y:h}).show(),t.attr({y:h-n/2})):this.horizontalLine.hide(),s?(this.verticalLine.attr({x:d,height:"100%"}).show(),t.attr({x:d-a/2})):this.verticalLine.hide()}catch(e){console.error(e)}}hideAlignLines(){this.option.disableAlignLine||(this.horizontalLine.hide(),this.verticalLine.hide())}initElement(t){this.dragableElement(t),this.updateElements(t,!0),this.hideEditElements(t),this.bindSelectEvent(t),this.bindMouseOverOutEvent(t),this.registerElement(t)}elementDragMove(t,e,i){let a=this.scaleValue,n={x:t.ox+e/a,y:t.oy+i/a};t.attr(n),this.handleAlignLines(t),this.updateElements(t),this.showEditElements(t)}elementDragStart(t){t.ox=t.attr("x"),t.oy=t.attr("y"),t.attr({opacity:.8}),this.endInputEdit(),t.attr("cursor","move")}resizeOnStart(t){t.ox=t.attr("x"),t.oy=t.attr("y")}resizeOnMove(t,e,i,a,n){let o,r,l,s;t.attr({x:t.ox+e,y:t.oy+i});let d=t.data("diagonal"),h=t.data("host");if(d){if(o=Math.min(t.attr("x"),d.attr("x"))+7.5,r=Math.min(t.attr("y"),d.attr("y"))+7.5,l=Math.abs(t.attr("x")-d.attr("x"))-10,s=Math.abs(t.attr("y")-d.attr("y"))-10,"mutiSubProcess"==h.data("type")){let t=this.getContainerBoundary(h.id);t&&(l=Math.max(l,t.boundaryX-o),s=Math.max(s,t.boundaryY-r))}else l=Math.max(l,80),s=Math.max(s,30);var c=t.data("direction");"w"==c||"e"==c?h.attr({x:o,width:l}):"n"==c||"s"==c?h.attr({y:r,height:s}):h.attr({x:o,y:r,width:l,height:s})}this.updateElements(h),this.showEditElements(h)}linkToolOnDragMove(t,e,i){let{x:a,y:n}=t.attrs,o=a+e/(this.scaleValue||1),r=n+i/(this.scaleValue||1),l=t.data("dropEndRect"),s=t.data("from");null==l?(l=this.renderRect(o,r,20,5).attr({fill:"#000000",cursor:"move",opacity:0}).hide(),t.data("dropEndRect",l)):l.attr({x:o,y:r});let d=this.getLinePathData(s,l,!0),h=t.data("virtualPath");null==h?(h=this.paper.path(d.data).attr({stroke:this.option.settings.themeColor,"stroke-width":2,fill:this.option.settings.themeColor}),h.node&&h.node.setAttribute("stroke-dasharray","2 2"),t.data("virtualPath",h)):h.attr("path",d.data),h.show(),h.data("from",s),this.dragingLine=h,this.validateDropLink(h)}linkToolOnDragUp(t){this.hideDropRect();let e=t.data("virtualPath");e&&e.hide();let i=this.dropNode;if(i){if(!this.validateDropLink(e))return console.log(" ----------------- validateDropLink false "),void(this.dragingLine=null);let t=e.data("from");if(t==i)return void(this.dragingLine=null);let a=this.isConnect(t,i,!0),n=this.createPath(t,i);if(this.dropNode=null,this.dragingLine=null,a){let t,e=n.data("start").attr("x"),i=n.data("start").attr("y"),a=n.data("end").attr("x"),o=n.data("end").attr("y"),r=0,l=0,s=3.141592653;if(i==o)r=(e+a)/2,t=Math.abs(a-e),l=i-t/2*Math.tan(15/180*s),l=Math.max(l,1);else if(e==a);else{t=Math.sqrt((a-e)*(a-e)+(o-i)*(o-i));let n=t/2*Math.tan(15/180*s),d=(e+a)/2,h=(i+o)/2,c=-(a-e)/(o-i),p=Math.atan(c),u=Math.sin(p);r=n*Math.cos(p)+d,l=n*u+h}if(r||l){let t=n.data("start").data("rightRect");t.attr({x:r,y:l}),this.updatePathByControlRect(t)}}}else this.dragingLine=null}validateDropLink(t,e){let i="Simple"!=this.designMode,a=this.dropNode;if(a){let n=function(t,e){let i=t.data("container")==e.data("container");return i||a.attr("cursor","not-allowed"),i},o=t.data("from"),r=t.data("to"),l=o.data("type"),s=a.data("type");if("start"==s&&!e)return a.attr("cursor","not-allowed"),!1;if(!(e?n(a,r):n(o,a)))return!1;let d=e?a.data("out"):o.data("out");if(d)for(let t in d){if(d[t].data("to")==(e?r:a))return a.attr("cursor","not-allowed"),!1}if(!i)return!0;if(e){if(o==a)return!0;if("diverage"!=s){let t=a.data("out");if((t&&Object.getOwnPropertyNames(t).length)>0)return a.attr("cursor","not-allowed"),!1}if("end"==s)return a.attr("cursor","not-allowed"),!1;o=a}else{if("converge"!=s){if(r==a)return!0;let t=a.data("in");if((t&&Object.getOwnPropertyNames(t).length)>0)return a.attr("cursor","not-allowed"),!1}if("diverage"!=l){if(r)return n(o,a);let t=o.data("out");if((t&&Object.getOwnPropertyNames(t).length)>0)return a.attr("cursor","not-allowed"),!1}}}return!0}hideEditElements(t){let e=null;if(t&&"rect"!=(e=t.type)&&"image"!=e&&"html"!=e){if("path"==e){let e=t.data("start");e.hide();let i=e.data("right");for(;i;){i.hide(),i.data("leftRect").hide(),i=i.data("right")}}}else{let{nw:t,w:e,sw:i,n:a,s:n,ne:o,e:r,se:l,dashOuterPath:s,linkTool:d,nextTaskTool:h,nextSplitTool:c,nextEndTool:p,deleteTool:u}=this;t.hide(),e.hide(),i.hide(),a.hide(),n.hide(),o.hide(),r.hide(),l.hide(),s.hide(),d.hide(),h.hide(),c.hide(),p.hide(),u.hide()}t&&t.attr("cursor","auto")}setSelectElement(t){this.selectElement=t,this.showEditElements(t)}showEditElements(t){if(!this.option.editable)return;let e=t.type,i="image"==e;if("rect"==e||i||"html"==e){let{x:e,y:a,width:n,height:o}=t.attrs,r=t.data("nodeType"),{nw:l,w:s,sw:d,n:h,s:c,ne:p,e:u,se:g,dashOuterPath:m,linkTool:y,nextTaskTool:f,nextSplitTool:x,nextEndTool:v,deleteTool:w}=this,A=e-5,b=a-5,E=e+n+5,M=a+o+5,k=E-A,C=M-b,T="M"+A+","+b+"L"+A+","+M+"L"+E+","+M+"L"+E+","+b+"L"+A+","+b;m.attr({path:T,fill:"none",stroke:"#909399"}).show(),i||(l.data("host",t).attr({x:A-2.5,y:b-2.5}).show(),s.data("host",t).attr({x:A-2.5,y:b+C/2-2.5}).show(),d.data("host",t).attr({x:A-2.5,y:M-2.5}).show(),h.data("host",t).attr({x:A+k/2-2.5,y:b-2.5}).show(),c.data("host",t).attr({x:A+k/2-2.5,y:M-2.5}).show(),p.data("host",t).attr({x:E-2.5,y:b-2.5}).show(),u.data("host",t).attr({x:E-2.5,y:b+C/2-2.5}).show(),g.data("host",t).attr({x:E-2.5,y:M-2.5}).show()),"End"!=r?(y.data("from",t).attr({x:E+10,y:b}).show(),f.data("from",t).attr({x:E+10,y:b+16}).show(),x.data("from",t).attr({x:E+10,y:b+32}).show(),v.data("from",t).attr({x:E+10,y:b+48}).show(),w.attr({x:E+10+16,y:b-5}).data("host",t).show()):w.attr({x:E+10,y:b-5}).data("host",t).show()}else if("path"==e){let e=t.data("start");e.show();let i=e.data("right");for(;i;){i.show(),i.data("leftRect").show(),i=i.data("right")}let{x:a,y:n}=t.getPointAtLength(1);this.deleteTool.attr({x:a,y:n}).data("host",t).show()}t.attr("cursor","move")}updateActiveText(t,e){this.textElement&&(this.textElement.attr("text",t),e&&this.textElement.show())}updateElements(t){let e=this,i=t.data("text");if(i){let{x:e,y:a,width:n,height:o}=t.attrs,r=e+n/2,l=a+o/2;i.attr("x",r).attr("y",l)}if(t.data("in")){let i=t.data("in");for(let t in i)e.updateLine(i[t])}if(t.data("out")){let i=t.data("out");for(let t in i)e.updateLine(i[t])}}updateLine(t){let e=t.data("start"),i=t.data("end");if(e.data("fromNode")){let t=e.data("fromNode"),a=e.data("right"),n=i==a&&null!=i.data("toNode"),o=this.getLinePathData(t,n?i.data("toNode"):a,!1).start;e.attr({x:o.x-2.5,y:o.y-2.5}),e.data("rightRect").attr({x:(e.attr("x")+a.attr("x"))/2,y:(e.attr("y")+a.attr("y"))/2})}if(i.data("toNode")){let a=i.data("toNode"),n=i.data("left"),o=e==n&&null!=e.data("fromNode"),r=this.getLinePathData(o?e.data("fromNode"):n,a,!1).end;i.attr({x:r.x-2.5,y:r.y-2.5}),t.data("container")&&this.relativePosition(i,t.data("container")),i.data("leftRect").attr({x:(n.attr("x")+i.attr("x"))/2,y:(n.attr("y")+i.attr("y"))/2})}this.updatePath(t)}updatePath(t){let e=t.data("pathStyle");switch(e){case"broken":{let e=t.data("start"),i=e.data("rightRect");t.data("text").attr({x:i.attr("x")-10,y:i.attr("y")-10});let a="M"+(e.attr("x")+2.5)+","+(e.attr("y")+2.5),n=e.data("right");for(;n;)a+="L"+(n.attr("x")+2.5)+","+(n.attr("y")+2.5),n=n.data("right");t.attr("path",a);break}case"straight":this.resetPathData(t,t.data("from"),t.data("to"),e)}}updatePathByControlRect(t){let e=t.data("host"),i=t.data("controlPointIndex"),a=t.data("left"),n=t.data("right"),o=t.data("disableRestore");if(t.data("restore"))return t.attr({x:(a.attr("x")+n.attr("x"))/2,y:(a.attr("y")+n.attr("y"))/2}),void(e.data("container")&&this.relativePosition(t,e.data("container")));if(a&&a.data("fromNode")){let e=a.data("fromNode"),i=this.getLinePathData(e,t,!1).start;a.attr({x:i.x-2.5,y:i.y-2.5})}if(n&&n.data("toNode")){let i=n.data("toNode"),a=this.getLinePathData(t,i,!1).end;n.attr({x:a.x-2.5,y:a.y-2.5}),e.data("container")&&this.relativePosition(n,e.data("container"))}if(-1==i){let e=t.data("leftRect");e.attr("x",(a.attr("x")+t.attr("x"))/2),e.attr("y",(a.attr("y")+t.attr("y"))/2);let i=t.data("rightRect");if(i.attr("x",(n.attr("x")+t.attr("x"))/2),i.attr("y",(n.attr("y")+t.attr("y"))/2),!o){let o=t.attr("x"),r=t.attr("y"),l=a.attr("x"),s=a.attr("y"),d=n.attr("x"),h=n.attr("y"),c=(o-l)*(o-d)>0&&(r-s)*(r-h)>0;this.distanceFromPointToLine(o,r,l,s,d,h)<=3&&!c&&(e.remove(),i.remove(),t.data("restore",!0),a.data("right",n),a.data("rightRect",t),n.data("left",a),n.data("leftRect",t),t.attr({x:(a.attr("x")+n.attr("x"))/2,y:(a.attr("y")+n.attr("y"))/2}))}}else{t.data("disableRestore",!0);let i=this.createControlDragRect((a.attr("x")+t.attr("x")+5)/2,(a.attr("y")+t.attr("y")+5)/2,e);i.data("controlPointIndex",0),i.data("left",a),i.data("right",t);let o=this.createControlDragRect((n.attr("x")+t.attr("x")+5)/2,(n.attr("y")+t.attr("y")+5)/2,e);o.data("controlPointIndex",0),o.data("left",t),o.data("right",n),t.data("leftRect",i),t.data("rightRect",o),n.data("leftRect",o),a.data("rightRect",i),n.data("left",t),a.data("right",t),t.data("controlPointIndex",-1)}this.updatePath(e)}updatePathBound(t){let e=t.data("from"),i=t.data("to"),a=t.data("start"),n=t.data("end"),o=a.data("right"),r=a.data("rightRect"),l=e,s=o;o==n&&(s=i);let d=this.getLinePathData(l,s,!1).start;a.attr({x:d.x-2.5,y:d.y-2.5}),r.attr({x:(a.attr("x")+o.attr("x"))/2,y:(a.attr("y")+o.attr("y"))/2}),i=t.data("to");let h=n.data("leftRect"),c=n.data("left");l=c,a==c&&(l=e),s=i;let p=this.getLinePathData(l,s,!1).end;n.attr({x:p.x-2.5,y:p.y-2.5}),h.attr({x:(c.attr("x")+n.attr("x"))/2,y:(c.attr("y")+n.attr("y"))/2})}getContainerBoundary(t){let e,i,a,n,o=this.containers[t].elements,r=this.containers[t].target;e=r.attr("x"),i=r.attr("y"),a=r.attr("x")+300,n=r.attr("y")+150;for(let l in o){let t=o[l],e=t.attr("x"),i=t.attr("y"),r=t.attr("width"),s=t.attr("height");a=Math.max(a,e+r+10),n=Math.max(n,i+s+10)}return{x:e,y:i,boundaryX:a,boundaryY:n}}isDropContainer(t,e){if(!t||!e)return;let{x:i,y:a}=t.attrs,{x:n,y:o,width:r,height:l}=e.attrs;return i>=n&&i<=n+r&&a>=o&&a<=o+l}autoContainerSelect(t){}isOutContainerBoundary(t,e,i,a,n){let o=n.attr("x"),r=n.attr("y"),l=n.attr("width"),s=n.attr("height");return!(t>o+5&&t+i<o+l-5&&e>r+5&&e+a<r+s-5)}relativePosition(t,e){let i={x:t.attr("x")-e.attr("x"),y:t.attr("y")-e.attr("y")};t.data("relativePosition",i)}initIdPond(t,e){for(let i=t;i<e;i++)this.idPool.push(i)}nextId(){if(0==this.idPool.length&&this.initIdPond(1,100),1==this.idPool.length){let t=this.idPool[0];this.initIdPond(t+1,t+100)}return this.idPool.shift()}createElementId(){return this.toElementId(this.nextId())}toElementId(t){return t.toString()}getNumberBy(t){let e=t.indexOf("#");return e>-1?Number(t.substring(0,e)):t}recoveryId(t){let e=this.idPool;e.includes(t)&&e.unshift(t),e.sort((function(t,e){return t-e}))}unbindElementFromContainer(t,e){delete this.containers[e.id].elements[t.id]}removeContainer(t){let e=t.target.id;delete t.elements,delete t.target,this.unregisterElement(e),delete this.containers[e]}unregisterElement(t){"number"==typeof t&&this.recoveryId(t),this.elements[t]=null,delete this.elements[t]}registerElement(t){let e=t.id;e?this.elements[e]=t:this.alertMessage("register error: id is null!")}registerContainer(t){this.containers=this.containers||{},this.containers[t.id]={elements:{},target:t}}isConnect(t,e,i){let a={},n=t.data("out");a[t.id]=t;let o=0;for(;n&&Object.getOwnPropertyNames(n).length;){var r={};for(var l in n){var s=n[l].data("to");if(s==e)return!0;if(!a[s.id]){var d=s.data("out");for(var h in d)r[h]=d[h]}}if(n=r,o++>1e3)return console.log(" maybe bug happen ! "),!1}return!!i&&this.isConnect(e,t,!1)}getElementDatas(t,e){let i={};for(let a in e){let n=t.data(a);if(!n){let i=e[a],o=typeof i;n="object"==o?{}:"function"==o?i(t):i}i[a]=n}return i}setElementDatas(t,e,i){for(let a in e){let n=i[a];if(!n){let i=e[a],o=typeof i;n="object"==o?{}:"function"==o?i(t):i}t.data(a,n)}}isAloneConnect(t){if("path"!=t.type)return null;let e=t.data("from");return e&&1==Object.keys(e.data("out")).length}getSourceGatewayType(t){if("path"!=t.type)return null;let e=t.data("from");return"Split"!=e.data("nodeType")?null:e.data("gateway")}setElementName(t,e){let i=null;t&&(i=t.data("text"))&&i.attr("text",e)}setConnectArrow(t,e){t.node&&(e||(e=t.attr("stroke"),B(this.paper.canvas,e)),t.node.style.markerEnd=`url(#connect-arrow-${e})`)}setConnectColor(t,e){t.attr("stroke",e),this.setConnectArrow(t,e),this.setConnectType(t)}setConnectType(t,e){if(t.node){let i=t.attr("stroke");switch(B(this.paper.canvas,i),e||(e=t.data("conditionType")||"Always"),e){case"Always":t.data("conditionType","Always"),t.node.style.markerStart=null;break;case"Script":case"HandlerCall":t.data("conditionType",e),t.node.style.markerStart=`url(#connect-condition-${i})`}}}toElementData(t){let e=t.type;if("path"!=e){let i={},n=t.data("nodeType"),o=t.data("text"),r=a({},t.attrs),l={type:e,attrs:r,textAttrs:o&&o.attrs};return delete r.opacity,delete r.cursor,"image"==e&&(delete r.src,delete l.textAttrs),Object.assign(i,a(a({id:t.id,name:o&&o.attr("text"),type:n},this.getElementDatas(t,this.nodeDatas)),{component:l})),i}{let i=t.data("from"),n=t.data("to"),o=t.data("text");return a(a({id:t.id,name:o.attr("text"),fromId:i.id,toId:n.id},this.getElementDatas(t,this.connectDatas)),{component:{type:e,attrs:t.attrs,textAttrs:o.attrs}})}}fromElementData(t){let{id:e,type:i,gateway:a,component:n}=t,o=null;if("path"==n.type){let{fromId:e,toId:i}=t,a=this.elements[e],n=this.elements[i];o=this.createConnectElement(t,a,n),this.setElementDatas(o,this.connectDatas,t),this.setConnectType(o,t.conditionType)}else switch(i){case"Start":o=this.loadHTMLElement(e,"start",n,"Start"),this.setElementDatas(o,this.nodeDatas,t);break;case"End":o=this.loadHTMLElement(e,"end",n,"End"),this.setElementDatas(o,this.nodeDatas,t);break;case"Split":{let i=a.toLowerCase();o=this.loadHTMLElement(e,i,n,"Split"),this.setElementDatas(o,this.nodeDatas,t);break}case"Join":o=this.loadHTMLElement(e,"join",n,"Join"),this.setElementDatas(o,this.nodeDatas,t);break;default:o=this.createNodeElement(t),this.setElementDatas(o,this.nodeDatas,t),o.data("nodeType",i)}this.elements[e]=o}getData(){let t={id:this.processId||"",name:this.processName||""},e=null,{elements:i}=this,a=t.nodes=[],n=t.connects=[];for(let o in i){let t=i[o],r=this.toElementData(t);if("path"!=t.type){"Start"==t.data("nodeType")&&(e=o),a.push(r)}else n.push(r)}return t.startNodeId=e,t}setData(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(o){}let{id:e,name:i,nodes:a=[],connects:n=[]}=t||{};this.reset(),this.processId=e,this.processName=i;for(let r of a)this.fromElementData(r);for(let r of n)this.fromElementData(r);this.setElementsColor(this.option.settings.themeColor)}validate(){if(!this.processId)return"流程id不能为空";if(!this.processName)return"流程名称不能为空";let t=[],e=[],{elements:i}=this,a=[];for(let l in i){let n=i[l];if("path"!=n.type){let i=n.data("nodeType"),o=n.data("text"),r=o&&o.attr("text"),s=n.data("in")||{},d=n.data("out")||{};if("Start"==i){if(t.push(l),0==Object.keys(d).length)return this.setSelectElement(n),"开始节点没有定义出口"}else if("End"==i){if(e.push(l),0==Object.keys(s).length)return this.setSelectElement(n),"结束节点没有定义入口"}else{if(0==Object.keys(s).length)return this.setSelectElement(n),`节点[id=${l},name=${r}]没有定义入口`;if(0==Object.keys(d).length)return this.setSelectElement(n),`节点[id=${l},name=${r}]没有定义出口`;a.push(n)}}}let n=[],o=[];for(let l of a){let t=l.id,e=l.data("text"),i=e&&e.attr("text");if(this.checkClosedLoop(l))return this.setSelectElement(l),`从节点[id=${t},name=${i}]开始存在闭环`;let a=l.data("nodeType"),r=l.data("gateway");"Split"==a&&"XOR"!=r&&n.push(l),"Join"==a&&o.push(l)}let r=t.length;if(0==r)return"流程没有找到开始节点";if(r>1)return"流程开始节点有且只能有一个";if(0==e.length)return"流程没有找到结束节点";for(let l of n){let t=this.matchJoinElement(l,o),{id:e}=l;if(!t)return this.setSelectElement(l),`并行分支节点[id=${e}]没有匹配到相对应的聚合网关。`;let i=o.indexOf(t);o.splice(i,1)}return null}matchJoinElement(t,e){if(!e||0==e.length)return null;let i=this.getExitPaths(t),a=[];for(let n of e){let t=n.id,e=!1,o=0;for(let a of i){let i=a.indexOf(t);if(-1==i){e=!0;break}o=Math.max(o,i)}e||a.push({maxIndex:o,joinElement:n})}return 0==a.length?null:(a.sort(((t,e)=>t.maxIndex>e.maxIndex?-1:1)),a[0].joinElement)}getExitPaths(t,e){if(!t)return null;let i=t.data("nodeType");if("End"==i||"Termination"==i)return[[t.id]];let a=t.data("out");if(!a||0==Object.keys(a).length)return[[t.id]];e||(e=[]);let n=[];for(let o in a){let i=a[o].data("to");if(!e.includes(o)){let a=[...e,o],r=this.getExitPaths(i,a);for(let e of r)e.unshift(t.id),n.push(e)}}return n}checkClosedLoop(t){let e=(t,i)=>{if("End"==t.data("nodeType"))return!0;let a=t.id;if(i.includes(a))return!1;i.push(a);let n=t.data("out")||{};if(0==Object.keys(n).length)return!1;for(let o in n){let t=n[o].data("to");if(e(t,i))return!0}return!1};return!e(t,[])}setEditable(t){this.option.editable=t,t||this.hideEditElements(this.selectElement),this.endInputEdit()}getElementById(t){return this.elements[t]}getElementByUUID(t){if(!t)return null;let e=Object.values(this.elements);for(let i of e){if(i.data().uuid==t)return i}return null}setElementsColor(t){this.connectColors.includes(t)||(this.connectColors.push(t),B(this.dom,t));for(let h in this.elements){let e=this.elements[h],i=e.type;"path"==i?this.setConnectColor(e,t):"html"==i?e.attr("color",t):e.attr("stroke",t)}let{nw:e,w:i,sw:a,n:n,s:o,ne:r,e:l,se:s,dashOuterPath:d}=this;e.attr("stroke",t),i.attr("stroke",t),a.attr("stroke",t),n.attr("stroke",t),o.attr("stroke",t),r.attr("stroke",t),l.attr("stroke",t),s.attr("stroke",t),d.attr("stroke",t),this.groupSelection.attr("stroke",t)}setThemeColor(t){this.option.settings.themeColor=t,this.setElementsColor(t),this.setMenuStyle({color:t}),this.setToolsStyle({color:t})}alertMessage(t,e){"function"==typeof this.option.alertMessage?this.option.alertMessage(t,e):console.info(t,e)}setElementColorById(t,e){let i=this.getElementById(t);return this.setElementColor(i,e),i}setElementColorByUUID(t,e){let i=this.getElementByUUID(t);return this.setElementColor(i,e),i}setElementColor(t,e){if(!t)return;let i=t.type;if("path"==i){let i={stroke:e};t.attr(i),this.setConnectArrow(t),this.setConnectType(t)}else"html"==i?t.attr("color",e):t.attr({stroke:e})}clearCompleteRecords(){this.completeRecords=[]}completeElementColorById(t,e){let i=this.setElementColorById(t,e);i&&this.completeFrontLines(i,e)}completeElementColorByUUID(t,e){let i=this.setElementColorByUUID(t,e);i&&this.completeFrontLines(i,e)}completeFrontLines(t,e){if(console.log(" completeFrontLines ",this.completeRecords),!t)return;this.completeRecords||(this.completeRecords=[]),this.completeRecords.push(this.getElementId(t));let i=t.data("in");for(let a in i){let t=i[a];if(!this.completeRecords.includes(a)){this.completeRecords.push(a);let i=t.data("from");this.completeRecords.includes(this.getElementId(i))&&this.setElementColor(t,e)}}}getElementId(t){let{id:e}=t.data();return e||t.id}complete(t,e,i){i=i||this.option.settings.completeColor;let a=this.getElementById(t);if(!a)return void this.alertMessage("开始节点[id="+t+"]不存在",5);let n=null,o=null,r=a.data("out");if(r)for(let s in r){let t=r[s],i=t.data("to");if(i.id==e){o=t,n=i;break}}if(!n)return void this.alertMessage("结束节点[id="+e+"]不存在或无效",5);"html"==a.type?a.attr("color",i):a.attr({stroke:i}),"html"==n.type?n.attr("color",i):n.attr({stroke:i});let l={fill:i,stroke:i};o.attr(l),this.setConnectArrow(o)}completeQueue(t){if(!Array.isArray(t)||t.length<2)return void this.alertMessage("参数错误",5);let e=t[0];for(let i=1,a=t.length;i<a;++i)this.complete(e,t[i]),e=t[i]}getConnect(t,e){for(let i in this.elements){let a=this.elements[i];if("path"==a.type&&a.data("from").id==t&&a.data("to").id==e)return a}return null}importJSON(t,e){this.setData(t),e||this.overview()}exportJSON(){let t=this.validate();if(t)return void this.alertMessage("流程图错误："+t,5);let e=this.getData();((t,e)=>{let i=new Blob([t]),a="导出文件";"string"==typeof e&&(a=e),m(i,a)})(JSON.stringify(e,null,4),`${this.processId||"flow"}.json`)}onImportFile(t){let e=this,i=t.target.files;if(i&&i.length>0){let t=i[0],a=t.name;if(console.log(a),!a.toLowerCase().endsWith(".json"))return void this.alertMessage("只支持JSON格式文件",5);console.log(t);let n=new FileReader;n.readAsText(t,"utf-8"),n.onload=t=>{let i=t.target.result;e.importJSON(i)}}t.target.value=null}handleImport(){this.fileInput.click()}exportImage(){const t=this.flowWrapper,e=(new XMLSerializer).serializeToString(t);let i=`<svg xmlns="http://www.w3.org/2000/svg" width="2000" height="2000">\n                <foreignObject x="0" y="0" width="100%" height="100%">\n                    ${e}\n                </foreignObject>\n             </svg>`;console.log(e);const a=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(i)))}`,n=new Image;n.src=a,n.onload=()=>{console.log("onload ");const t=document.createElement("canvas");t.width=n.width,t.height=n.height;t.getContext("2d").drawImage(n,0,0);let e=t.toDataURL("image/png").split(","),i=atob(e[1]),a=i.length,o=new Uint8Array(a);for(;a--;)o[a]=i.charCodeAt(a);const r=new Blob([o],{type:"image/png"});m(r,`${this.processId||"flow"}.png`)}}clearElements(){for(let t in this.elements){this.elements[t].remove(),this.elements[t]=null}this.paper.clear()}reset(){this.clearElements(),this.initData(),this.initControlElements(),this.initPaper()}destroy(){this.clearElements(),this.paper.remove(),this.dom.innerHTML="",this.initData(),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("keyup",this.handleDocumentKeyUp)}}let{properties:X,methods:K}=I;Object.assign(G.prototype,X),Object.assign(G.prototype,K);const Q={render:(t,e)=>new G(t,e)};try{Object.assign(window,{"wastflow-version":"1.0.0-beta29",__wf:Q})}catch(Z){console.warn(Z)}export{Q as default};
